{"version":3,"sources":["webpack:///ImageInput.svelte","webpack:///CustomExtensions.svelte","webpack:///LearnMore.svelte","webpack:///ColorPicker.svelte","webpack:///./src/packager/idb.js","webpack:///./src/p4/file-store.js","webpack:///./src/p4/preview.js","webpack:///./src/p4/deep-clone.js","webpack:///./src/packager/sha256.js","webpack:///./src/packager/images/default-icon.png","webpack:///./src/packager/large-assets.js","webpack:///./src/packager/icns.js","webpack:///./src/packager/build-id.js","webpack:///./src/packager/cache.js","webpack:///./src/packager/base85.js","webpack:///./src/packager/plist.js","webpack:///./src/packager/packager.js","webpack:///PackagerOptions.svelte"],"names":["replace","name","ACCEPT","dropping","url","file","previewSizes","URL","revokeObjectURL","createObjectURL","e","stopPropagation","input","document","createElement","type","accept","join","addEventListener","files","target","length","body","appendChild","click","remove","detail","dataTransfer","droppedFile","some","ext","endsWith","map","i","extensions","value","split","filter","slug","href","link","Database","version","storeName","this","db","indexedDB","Error","navigator","userAgentData","test","userAgent","databases","Promise","resolve","intervalId","tryIdb","finally","setInterval","clearInterval","idbReady","reject","request","open","onupgradeneeded","result","createObjectStore","keyPath","onsuccess","onopen","then","catch","err","onerror","error","readwrite","transaction","store","objectStore","createTransaction","setTransactionErrorHandler","openCursor","cursor","delete","continue","makeNamedBlob","buffer","blob","Blob","get","async","key","data","cloneBlob","hasQueried","subscribe","arrayBuffer","put","id","set","console","warn","origin","location","canUseBlobWindow","source","JSON","stringify","previewURL","windowToBlobMap","WeakMap","window","preview","postMessage","write","content","progress","text","close","deepClone","obj","Array","isArray","push","Object","keys","worker","Worker","terminate","LARGE_ASSET_BASE","src","sha256","scaffolding","SCAFFOLDING_ROOT","estimatedSize","useBuildId","addons","canvasToBlob","canvas","toBlob","pngData","Icns","Buffer","pngDataBlob","image","Image","onload","eligibleFormats","size","format","width","height","ctx","getContext","icns","formatSize","drawImage","icnsImage","IcnsImage","fromPNG","from","append","SCAFFOLDING_BUILD_ID","getAssetId","asset","allValidAssetIds","values","includes","removeExtraneous","assetId","decode","str","getValue","code","lengthEndsAt","indexOf","byteLength","substring","resultBuffer","ArrayBuffer","n","resultView","Uint32Array","j","charCodeAt","Uint8Array","xmlToValue","node","tagName","child","children","textContent","nextElementSibling","valueToXml","doc","listItem","keyValue","entries","keyNode","valueNode","escapeXML","v","getJSZip","default","setFileFast","zip","path","getAppIcon","xhr","SELF_LICENSE","title","homepage","license","SCRATCH_LICENSE","ELECTRON_LICENSE","COPYRIGHT_HEADER","generateChromiumLicenseHTML","licenses","index","super","project","options","DEFAULT_OPTIONS","aborted","dispatchEvent","Event","ensureNotAborted","__ASSETS__","dispatchProgress","CustomEvent","cameFromCache","cached","progressCallback","abortTarget","buildId","verifyBuildId","hash","chunks","specialCloudBehaviors","cloudVariables","pause","controls","enabled","texts","analysis","usesMusic","fetchLargeAsset","getAddonOptions","script","stageWidth","stageHeight","greenFlag","stopAll","projectZip","nwjsBuffer","nwjsZip","loadAsync","isWindows","startsWith","isMac","isLinux","nwjsPrefix","packageName","app","newPath","icon","manifest","main","computeWindowSize","dataPrefix","icnsData","startScript","unixPermissions","creditsHtmlPath","creditsHtml","electronZip","resourcePrefix","mainJS","appearance","background","windowTitle","readme","appZip","newAppName","contentsPrefix","parsedBackgroundColor","parseInt","substr","applicationConfig","plist","string","rootDict","DOMParser","parseFromString","parsePlist","CFBundleIdentifier","CFBundleName","CFBundleExecutable","xml","implementation","createDocument","rootNode","documentElement","setAttribute","XMLSerializer","serializeToString","generatePlist","cloudHost","projectId","variables","custom","provider","Set","makeWebSocketProvider","makeLocalStorageProvider","variableName","providerToUse","extension","storageProgressStart","storageProgressEnd","getProjectDataFunction","isZip","SEGMENT_LENGTH","encoded","originalLength","newBuffer","originalView","newView","originalLengthAsString","toString","resultIndex","getChar","Math","floor","TextDecoder","encode","a","b","t","loadResources","html","foreground","loadingScreen","imageMode","accent","generateCursor","css","generateFavicon","progressBar","resizeMode","monitors","editableLists","username","mode","makeCustomProvider","fullscreen","turbo","interpolation","framerate","highQualityPen","fencing","miscLimits","maxClones","compiler","warpTimer","line","array","trim","js","generateGetProjectData","autoplay","addNwJS","addElectron","addWebViewMac","generateAsync","compression","platform","meta","percent","filename","generateFilename","getDefaultPackageNameFromFileName","toLowerCase","getWindowTitleFromFileName","gamepad","pointerlock","ALMOST_INFINITY","toFixed","visible","projectData","stageVariables","isCloud","defaultOptions","uniqueId","variable","hasSettingsStoredInProject","magic","stageComments","find","previewer","resetResult","customCursorIcon","loadingScreenImage","otherEnvironmentsInitiallyOpen","$options","runPackager","task","packager","abort","setProgressText","$_","thing","setProgress","package","resetOptions","properties","$progress","$icon","$customCursorIcon","$loadingScreenImage","do","done","download","downloadURL","optionsClone","setContent","checked"],"mappings":"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","file":"js/packager-options-ui.cf3bc388ed8e8663acf4.js","sourcesContent":["<script>\n  import {_} from '../locales';\n  import DropArea from './DropArea.svelte';\n\n  const ACCEPT = [\n    '.png',\n    '.jpg',\n    '.jpeg',\n    '.bmp',\n    '.svg',\n    '.ico',\n    '.gif'\n  ];\n\n  export let file;\n  export let previewSizes;\n  let dropping;\n  let url;\n\n  // This is a bit strange, there's probably a better way to do this\n  // Seems to create and revoke an extra object URL for each file for some reason\n  $: if (file) {\n    if (url) {\n      URL.revokeObjectURL(url);\n    }\n    url = URL.createObjectURL(file);\n  } else if (url) {\n    URL.revokeObjectURL(url);\n    url = null;\n  }\n\n  const clear = (e) => {\n    e.stopPropagation();\n    file = null;\n  };\n\n  const handleClickBackground = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = ACCEPT.join(',');\n    input.addEventListener('change', (e) => {\n      const files = e.target.files;\n      if (files.length) {\n        file = files[0];\n      } else {\n        file = null;\n      }\n    });\n    document.body.appendChild(input);\n    input.click();\n    input.remove();\n  };\n\n  const handleDrop = ({detail: dataTransfer}) => {\n    const droppedFile = dataTransfer.files[0];\n    if (ACCEPT.some((ext) => droppedFile.name.endsWith(ext))) {\n      file = droppedFile;\n    }\n  };\n</script>\n\n<style>\n  .container {\n    background: transparent;\n    color: #555;\n    width: 100%;\n    box-sizing: border-box;\n    border: 3px dashed currentColor;\n    transition: .2s border-color, .2s color;\n    border-radius: 20px;\n    min-height: 90px;\n    font: inherit;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    text-align: center;\n    overflow: hidden;\n    position: relative;\n    cursor: pointer;\n    padding: 4px;\n  }\n  :global([theme=\"dark\"]) .container {\n    color: #aaa;\n  }\n  .dropping,\n  .container:focus-visible,\n  .container:active {\n    color: rgb(79, 123, 211);\n  }\n  :global([theme=\"dark\"]) .dropping,\n  :global([theme=\"dark\"]) .container:focus-visible,\n  :global([theme=\"dark\"]) .container:active {\n    color: rgb(178, 195, 228);\n  }\n  .placeholder {\n    font-size: 1.5em;\n  }\n  .selected {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-wrap: wrap;\n  }\n  .selected > *:not(:last-child) {\n    margin-right: 12px;\n  }\n</style>\n\n<DropArea bind:dropping={dropping} on:drop={handleDrop}>\n  <button class=\"container\" class:dropping on:click={handleClickBackground}>\n    {#if file}\n      <div class=\"selected\">\n        {#each previewSizes as size}\n          <!-- svelte-ignore a11y-missing-attribute -->\n          <img src={url} width={size[0]} height={size[1]}>\n        {/each}\n        <div>{$_('fileInput.selected').replace('{file}', file.name)}</div>\n        <button on:click={clear}>{$_('fileInput.clear')}</button>\n      </div>\n    {:else}\n      <div class=\"placeholder\">{$_('fileInput.select')}</div>\n    {/if}\n  </button>\n</DropArea>\n","<script>\n  export let extensions;\n</script>\n\n<style>\n  textarea {\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 100%;\n    height: 100px;\n  }\n</style>\n\n<textarea\n  value={extensions.map(i => i.url).join('\\n')}\n  on:change={(e) => {\n    extensions = e.target.value.split('\\n').filter(i => i).map(i => ({url: i}));\n  }}\n></textarea>\n","<script>\n  import {_} from '../locales/';\n\n  export let slug;\n  export let href;\n\n  const link = slug ? `https://docs.turbowarp.org/${slug}` : href;\n</script>\n\n<style>\n  a {\n    text-decoration: none;\n  }\n  a:hover {\n    text-decoration: underline;\n  }\n</style>\n\n<a href={link} title={$_('options.learnMore')} target=\"_blank\" rel=\"noopener noreferrer\">(?)</a>\n","<script>\n  export let value;\n</script>\n\n<input type=\"color\" bind:value />\n","// https://github.com/jakearchibald/safari-14-idb-fix/blob/582bbdc7230891113bfb5743391550cbf29d21f2/src/index.ts\nconst idbReady = () => {\n  const isSafari =\n    !navigator.userAgentData &&\n    /Safari\\//.test(navigator.userAgent) &&\n    !/Chrom(e|ium)\\//.test(navigator.userAgent);\n\n  // No point putting other browsers or older versions of Safari through this mess.\n  if (!isSafari || !indexedDB.databases) return Promise.resolve();\n\n  let intervalId;\n  return new Promise((resolve) => {\n    const tryIdb = () => indexedDB.databases().finally(resolve);\n    intervalId = setInterval(tryIdb, 100);\n    tryIdb();\n  }).finally(() => clearInterval(intervalId));\n};\n\nclass Database {\n  constructor (name, version, storeName) {\n    this.name = name;\n    this.version = version;\n    this.storeName = storeName;\n    this.db = null;\n  }\n\n  async open () {\n    if (this.db) {\n      return this.db;\n    }\n    if (typeof indexedDB === 'undefined') {\n      throw new Error('indexedDB is not supported');\n    }\n    await idbReady();\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.name, this.version);\n      request.onupgradeneeded = (e) => {\n        const db = e.target.result;\n        db.createObjectStore(this.storeName, {\n          keyPath: 'id'\n        });\n      };\n      request.onsuccess = (e) => {\n        this.db = e.target.result;\n        this.onopen()\n          .then(() => {\n            resolve(this.db);\n          })\n          .catch((err) => {\n            reject(err);\n          });\n      };\n      request.onerror = (e) => {\n        reject(new Error(`IDB Error ${e.target.error}`));\n      };\n    });\n  }\n\n  async createTransaction (readwrite) {\n    const db = await this.open();\n    const transaction = db.transaction(this.storeName, readwrite);\n    const store = transaction.objectStore(this.storeName);\n    return {\n      db,\n      transaction,\n      store\n    };\n  }\n\n  async deleteEverything () {\n    const {transaction, store} = await this.createTransaction('readwrite');\n    return new Promise((resolve, reject) => {\n      Database.setTransactionErrorHandler(transaction, reject);\n      const request = store.openCursor();\n      request.onsuccess = e => {\n        const cursor = e.target.result;\n        if (cursor) {\n          cursor.delete();\n          cursor.continue();\n        } else {\n          resolve();\n        }\n      };\n    });\n  }\n\n  onopen () {\n    return Promise.resolve();\n  }\n}\n\nDatabase.setTransactionErrorHandler = (transaction, reject) => {\n  transaction.onerror = () => {\n    reject(new Error(`Transaction error: ${transaction.error}`))\n  };\n};\n\nexport default Database;\n","import {writable} from 'svelte/store';\nimport Database from '../packager/idb';\nimport {readAsArrayBuffer} from '../common/readers';\n\nconst DATABASE_NAME = 'p4-local-settings';\nconst DATABASE_VERSION = 1;\nconst STORE_NAME = 'blobs';\n\nconst db = new Database(DATABASE_NAME, DATABASE_VERSION, STORE_NAME);\n\nconst makeNamedBlob = (buffer, type, name) => {\n  const blob = new Blob([buffer], {type});\n  blob.name = name;\n  return blob;\n};\n\nconst cloneBlob = async (blob) => {\n  const buffer = await readAsArrayBuffer(blob);\n  return makeNamedBlob(buffer, blob.type, blob.name);\n};\n\nconst get = async (key) => {\n  const {transaction, store} = await db.createTransaction('readonly');\n  return new Promise((resolve, reject) => {\n    Database.setTransactionErrorHandler(transaction, reject);\n    const request = store.get(key);\n    request.onsuccess = (e) => {\n      const result = e.target.result;\n      if (result) {\n        const data = result.data;\n        // Older versions stored these files as instances of File\n        if (data instanceof Blob) {\n          // Clone immediately to fix spurious \"NotFoundError: Node was not found\" in Firefox\n          resolve(cloneBlob(data));\n        } else {\n          resolve(makeNamedBlob(data, result.type, result.name));\n        }\n      } else {\n        resolve(null);\n      }\n    };\n  });\n};\n\nconst set = async (key, file) => {\n  const arrayBuffer = file ? await readAsArrayBuffer(file) : null;\n  const {transaction, store} = await db.createTransaction('readwrite');\n  return new Promise((resolve, reject) => {\n    Database.setTransactionErrorHandler(transaction, reject);\n    const request = file ? store.put({\n      id: key,\n      data: arrayBuffer,\n      type: file.type,\n      name: file.name\n    }) : store.delete(key);\n    request.onsuccess = () => {\n      resolve();\n    };\n  });\n};\n\nconst resetAll = () => db.deleteEverything();\n\nconst writableFileStore = (key) => {\n  let hasQueried = false;\n  const store = writable(null, () => {\n    const unsubscribe = store.subscribe((file) => {\n      if (hasQueried) {\n        set(key, file)\n          .catch((err) => {\n            console.warn(err);\n          });\n      }\n    });\n    return unsubscribe;\n  });\n  get(key)\n    .then((value) => {\n      hasQueried = true;\n      if (value) {\n        store.set(value);\n      }\n    });\n  return store;\n};\n\nexport default {\n  writableFileStore,\n  resetAll\n};\n","import {isSafari, isStandalone} from './environment';\n\nconst origin = isStandalone ? '*' : location.origin;\n// Safari does not let file: URIs used by standalone version to open blob: URIs\nconst canUseBlobWindow = !(isStandalone && isSafari);\n\nconst source = `<!DOCTYPE html>\n<html>\n<head>\n  <title>Loading Preview</title>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n  <style>\n  body {\n    background: black;\n    color: white;\n    font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n  }\n  .preview-message {\n    background: inherit;\n    display: flex;\n    align-items: center;\n    flex-direction: column;\n    justify-content: center;\n    text-align: center;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n  .preview-progress-outer {\n    width: 200px;\n    height: 10px;\n    border: 1px solid white;\n  }\n  .preview-progress-inner {\n    height: 100%;\n    width: 0;\n    background: white;\n  }\n  [hidden] {\n    display: none;\n  }\n  </style>\n</head>\n<body>\n  <div class=\"preview-message\">\n    <div class=\"preview-progress-outer\"><div class=\"preview-progress-inner\"></div></div>\n  </div>\n  <div class=\"preview-message preview-error\" hidden>\n    <div class=\"preview-error-message\"></div>\n    <div>Go back to the original tab and try again</div>\n  </div>\n  <script>\n  (function() {\n    const origin = ${JSON.stringify(origin)};\n    const err = (message) => {\n      document.querySelector(\".preview-error\").hidden = false;\n      document.querySelector(\".preview-error-message\").textContent = \"Error: \" + message;\n    };\n    if (!window.opener) {\n      err(\"Can't communicate with main page.\");\n      return;\n    }\n    let hasRun = false;\n    const progressBar = document.querySelector(\".preview-progress-inner\");\n    const progressText = document.querySelector(\".preview-progress-text\");\n    window.addEventListener(\"message\", (e) => {\n      if (origin !== \"*\" && e.origin !== location.origin) return;\n      if (hasRun) return;\n      if (e.data.blob) {\n        hasRun = true;\n        const fr = new FileReader();\n        fr.onload = () => {\n          document.open();\n          document.write(fr.result);\n          document.close(); // fixes poor performance in firefox\n        };\n        fr.onerror = () => {\n          err(\"Something went wrong reading the file: \" + fr.error);\n        };\n        fr.readAsText(e.data.blob);\n      }\n      if (typeof e.data.progress === \"number\") {\n        progressBar.style.width = (e.data.progress * 100) + \"%\";\n      }\n    });\n    window.opener.postMessage({\n      preview: \"hello\"\n    }, origin);\n  })();\n  </script>\n</body>\n</html>\n`;\nconst previewURL = canUseBlobWindow ? URL.createObjectURL(new Blob([source], {\n  type: 'text/html'\n})) + '#do-not-share-this-link-it-will-not-work-for-others' : null;\n\nconst windowToBlobMap = new WeakMap();\n\nclass Preview {\n  constructor () {\n    if (canUseBlobWindow) {\n      this.window = window.open(previewURL);\n    } else {\n      this.window = window.open('about:blank');\n      if (this.window) {\n        this.window.document.write(source);\n      }\n    }\n    if (!this.window) {\n      throw new Error('Cannot open popup');\n    }\n  }\n\n  setContent (content) {\n    windowToBlobMap.set(this.window, content);\n    this.window.postMessage({\n      blob: content\n    }, origin);\n  }\n\n  setProgress (progress, text) {\n    this.window.postMessage({\n      progress,\n      text\n    }, origin);\n  }\n\n  close () {\n    this.window.close();\n  }\n}\n\nwindow.addEventListener('message', (e) => {\n  if (origin !== '*' && e.origin !== location.origin) {\n    return;\n  }\n  const data = e.data;\n  if (data && data.preview === 'hello') {\n    const source = e.source;\n    const blob = windowToBlobMap.get(source);\n    if (blob) {\n      source.postMessage({\n        blob\n      }, origin);\n    }\n  }\n});\n\nexport default Preview;\n","const deepClone = (obj) => {\n  if (obj instanceof Blob) {\n    return obj;\n  }\n  if (Array.isArray(obj)) {\n    const result = [];\n    for (const value of obj) {\n      result.push(deepClone(value));\n    }\n    return result;\n  }\n  if (obj && typeof obj === 'object') {\n    // TODO: there's probably some prototype pollution in here\n    const result = {};\n    for (const key of Object.keys(obj)) {\n      result[key] = deepClone(obj[key]);\n    }\n    return result;\n  }\n  // Primitive type\n  return obj;\n};\n\nexport default deepClone;\n","\n    import {wrap} from 'comlink';\n    const createWorker = () => {\n      const worker = new Worker(__webpack_public_path__ + \"js/sha256.52086ae4fb19cece366a.worker.js\");\n      const terminate = () => {\n        worker.terminate();\n      };\n      const wrapped = wrap(worker);\n      return {worker: wrapped, terminate};\n    };\n    export default createWorker;\n    ","export default __webpack_public_path__ + \"assets/default-icon.290e09e569a1cab8e61ba93b0d23863f.png\";","const LARGE_ASSET_BASE = 'https://packagerdata.turbowarp.org/';\nconst SCAFFOLDING_ROOT = 'scaffolding/';\n\nexport default {\n  'nwjs-win64': {\n    src: LARGE_ASSET_BASE + 'nwjs-v0.54.0-win-x64.zip',\n    sha256: '0f082671b67b711f783d98cc989cf5aebacfc9bce3bef78875b57d08fc2a6e86',\n    type: 'arraybuffer'\n  },\n  'nwjs-win32': {\n    src: LARGE_ASSET_BASE + 'nwjs-v0.54.0-win-ia32.zip',\n    sha256: '7a1ed3a6a51b8cdf9280761b90cb4723cf9ee8050e3ed0b58451e8e4e694b203',\n    type: 'arraybuffer'\n  },\n  'nwjs-mac': {\n    src: LARGE_ASSET_BASE + 'nwjs-v0.54.0-osx-x64.zip',\n    sha256: '498c97a264f8feac504c4c2396c1fddc8290c15573aee2fc692e59ff9803cc40',\n    type: 'arraybuffer'\n  },\n  'nwjs-linux-x64': {\n    src: LARGE_ASSET_BASE + 'nwjs-v0.54.0-linux-x64.zip',\n    sha256: '53651a3a12d29ad096cff5b44d9f1e3aa09e9fad970bdcfe8bda07ea23d960d8',\n    type: 'arraybuffer'\n  },\n  'electron-win32': {\n    src: LARGE_ASSET_BASE + 'electron-v15.0.0-win32-ia32.zip',\n    sha256: '5b69112b91010d78abf6012f387ea3fe5c0e36657c5f386a4c2bb42138aa1a8e',\n    type: 'arraybuffer'\n  },\n  'electron-win64': {\n    src: LARGE_ASSET_BASE + 'electron-v15.0.0-win32-x64.zip',\n    sha256: '3d95422d9f2fccb07b745b31007548231d80ff63e3640f49a5f8591498a3afa2',\n    type: 'arraybuffer'\n  },\n  'electron-linux64': {\n    src: LARGE_ASSET_BASE + 'electron-v15.1.1-linux-x64.zip',\n    sha256: '70de2da51c6a8591b88f08366c82166a51b1719243f67ef1a14eddbb806a115f',\n    type: 'arraybuffer'\n  },\n  'webview-mac': {\n    src: LARGE_ASSET_BASE + 'WebView-macos-3.zip',\n    sha256: '5d4086894f10549c61c20e5f770c808afc25c2e4793da75b5b1cede294449fac',\n    type: 'arraybuffer'\n  },\n  scaffolding: {\n    src: SCAFFOLDING_ROOT + 'scaffolding.js',\n    estimatedSize: 4775503,\n    useBuildId: true,\n    type: 'text'\n  },\n  'scaffolding-min': {\n    src: SCAFFOLDING_ROOT + 'scaffolding-min.js',\n    estimatedSize: 2540321,\n    useBuildId: true,\n    type: 'text'\n  },\n  addons: {\n    src: SCAFFOLDING_ROOT + 'addons.js',\n    estimatedSize: 14339,\n    useBuildId: true,\n    type: 'text'\n  }\n};\n","import {readAsArrayBuffer} from '../common/readers';\n\nconst loadImage = (src) => new Promise((resolve, reject) => {\n  const image = new Image();\n  image.onload = () => resolve(image);\n  image.onerror = () => reject(new Error(`Could not load image: ${src}`));\n  image.src = src;\n});\n\nconst canvasToBlob = (canvas) => new Promise((resolve, reject) => {\n  canvas.toBlob((blob) => {\n    if (blob) {\n      resolve(blob);\n    } else {\n      reject(new Error('Could not read <canvas> as blob'));\n    }\n  });\n});\n\nconst pngToAppleICNS = async (pngData) => {\n  const {\n    Icns,\n    Buffer\n  } = await import(/* webpackChunkName: \"icns\" */ './icns-bundle');\n\n  const FORMATS = [\n    { type: 'ic04', size: 16 },\n    { type: 'ic07', size: 128 },\n    { type: 'ic08', size: 256 },\n    { type: 'ic09', size: 512 },\n    { type: 'ic10', size: 1024 },\n    { type: 'ic11', size: 32 },\n    { type: 'ic12', size: 64 },\n    { type: 'ic13', size: 256 },\n    { type: 'ic14', size: 512 },\n  ];\n\n  // Read the Image.\n  const pngDataBlob = new Blob([pngData], {\n    type: 'image/png'\n  });\n  const url = URL.createObjectURL(pngDataBlob);\n  const image = await loadImage(url);\n\n  // Determine the formats to create\n  const eligibleFormats = FORMATS.filter((format) => {\n    // Always include the smallest size so that tiny images will get at least 1 image.\n    if (format.size === 16) {\n      return true;\n    }\n    return image.width >= format.size && image.height >= format.size;\n  });\n\n  // Create a single canvas to be used for conversion\n  // Creating many canvases is prone to error in Safari\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  if (!ctx) {\n    throw new Error('cannot get canvas rendering context');\n  }\n\n  const icns = new Icns.Icns();\n  for (const format of eligibleFormats) {\n    // Use the canvas to scale the image.\n    const formatSize = format.size;\n    canvas.width = formatSize;\n    canvas.height = formatSize;\n    ctx.drawImage(image, 0, 0, formatSize, formatSize);\n\n    const blob = await canvasToBlob(canvas);\n    const arrayBuffer = await readAsArrayBuffer(blob);\n    const icnsImage = await Icns.IcnsImage.fromPNG(Buffer.from(arrayBuffer), format.type);\n    icns.append(icnsImage);\n  }\n\n  return icns.data;\n};\n\nexport default pngToAppleICNS;\n","const SCAFFOLDING_BUILD_ID = process.env.SCAFFOLDING_BUILD_ID;\n\nconst verifyBuildId = (buildId, source) => {\n  if (source.endsWith('=^..^=')) {\n    return source.endsWith(`${buildId} =^..^=`);\n  }\n  return true;\n};\n\nexport {\n  SCAFFOLDING_BUILD_ID as buildId,\n  verifyBuildId\n};\n","import largeAssets from './large-assets';\nimport {buildId} from './build-id';\nimport Database from './idb';\n\n// We can't trust the HTTP cache to reliably cache these large assets\n\nconst DATABASE_NAME = 'p4-large-assets';\nconst DATABASE_VERSION = 1;\nconst STORE_NAME = 'assets';\n\nconst db = new Database(DATABASE_NAME, DATABASE_VERSION, STORE_NAME);\n\nconst getAssetId = (asset) => {\n  return `${asset.src}-${asset.type}-${asset.sha256 || buildId}`;\n};\n\nconst removeExtraneous = async () => {\n  const {transaction, store} = await db.createTransaction('readwrite');\n  return new Promise((resolve, reject) => {\n    Database.setTransactionErrorHandler(transaction, reject);\n    const allValidAssetIds = Object.values(largeAssets).map(getAssetId);\n    const request = store.openCursor();\n    request.onsuccess = e => {\n      const cursor = e.target.result;\n      if (cursor) {\n        const key = cursor.key;\n        if (!allValidAssetIds.includes(key)) {\n          cursor.delete();\n        }\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n  });\n};\n\nconst get = async (asset) => {\n  const {transaction, store} = await db.createTransaction('readonly');\n  return new Promise((resolve, reject) => {\n    Database.setTransactionErrorHandler(transaction, reject);\n    const assetId = getAssetId(asset);\n    const request = store.get(assetId);\n    request.onsuccess = (e) => {\n      const result = e.target.result;\n      if (result) {\n        resolve(result.data);\n      } else {\n        resolve(null);\n      }\n    };\n  });\n};\n\nconst set = async (asset, content) => {\n  const {transaction, store} = await db.createTransaction('readwrite');\n  return new Promise((resolve, reject) => {\n    Database.setTransactionErrorHandler(transaction, reject);\n    const assetId = getAssetId(asset);\n    const request = store.put({\n      id: assetId,\n      data: content\n    });\n    request.onsuccess = () => {\n      resolve();\n    };\n  });\n};\n\nconst resetAll = () => db.deleteEverything();\n\nremoveExtraneous();\n\nexport default {\n  get,\n  set,\n  resetAll\n};\n","// This implements a custom base85 encoding for improved efficiency compared to base64\n// The character set used is 0x2a - 0x7e of ASCII\n// 0x3c (<) is replaced with 0x28 (opening parenthesis) and 0x3e (>) is replaced with 0x29 (closing parenthesis)\n// Encoded data can be safely included in HTML without escapes\n\n// It's possible these functions will be stringified at runtime to be included in generated code,\n// so make sure that they're entirely self contained\n\n/**\n * @param {ArrayBuffer} buffer The data to encode\n * @returns {string} Encoded string\n */\nexport const encode = (buffer) => {\n  const originalLength = buffer.byteLength;\n  let data;\n  if (originalLength % 4 !== 0) {\n    const newBuffer = new ArrayBuffer(originalLength + (4 - originalLength % 4));\n    const originalView = new Uint8Array(buffer);\n    const newView = new Uint8Array(newBuffer);\n    for (let i = 0; i < originalView.length; i++) {\n      newView[i] = originalView[i];\n    }\n    data = new Uint32Array(newBuffer);\n  } else {\n    data = new Uint32Array(buffer);\n  }\n\n  const originalLengthAsString = originalLength.toString();\n  const resultBuffer = new ArrayBuffer(originalLengthAsString.length + 1 + data.byteLength * 5 / 4);\n  const resultView = new Uint8Array(resultBuffer);\n  let resultIndex = 0;\n  for (let i = 0; i < originalLengthAsString.length; i++) {\n    resultView[resultIndex++] = originalLengthAsString.charCodeAt(i);\n  }\n  resultView[resultIndex++] = 44; // ascii for \",\"\n\n  const getChar = (n) => {\n    n += 0x2a;\n    if (n === 0x3c) return 0x28;\n    if (n === 0x3e) return 0x29;\n    return n;\n  };\n  for (let i = 0; i < data.length; i++) {\n    let n = data[i];\n    resultView[resultIndex++] = getChar(n % 85);\n    n = Math.floor(n / 85);\n    resultView[resultIndex++] = getChar(n % 85);\n    n = Math.floor(n / 85);\n    resultView[resultIndex++] = getChar(n % 85);\n    n = Math.floor(n / 85);\n    resultView[resultIndex++] = getChar(n % 85);\n    n = Math.floor(n / 85);\n    resultView[resultIndex++] = getChar(n % 85);\n  }\n  return new TextDecoder().decode(resultBuffer);\n};\n\n/**\n * @param {string} str\n * @returns {Uint8Array}\n */\nexport const decode = (str) => {\n  const getValue = (code) => {\n    if (code === 0x28) code = 0x3c;\n    if (code === 0x29) code = 0x3e;\n    return code - 0x2a;\n  };\n  const toMultipleOfFour = (n) => {\n    if (n % 4 === 0) {\n      return n;\n    }\n    return n + (4 - n % 4);\n  };\n  const lengthEndsAt = str.indexOf(',');\n  const byteLength = +str.substring(0, lengthEndsAt);\n  const resultBuffer = new ArrayBuffer(toMultipleOfFour(byteLength));\n  const resultView = new Uint32Array(resultBuffer);\n  for (let i = lengthEndsAt + 1, j = 0; i < str.length; i += 5, j++) {\n    resultView[j] = (\n      getValue(str.charCodeAt(i + 4)) * 85 * 85 * 85 * 85 +\n      getValue(str.charCodeAt(i + 3)) * 85 * 85 * 85 +\n      getValue(str.charCodeAt(i + 2)) * 85 * 85 +\n      getValue(str.charCodeAt(i + 1)) * 85 +\n      getValue(str.charCodeAt(i))\n    );\n  }\n  return new Uint8Array(resultBuffer, 0, byteLength);\n};\n","// Parses and generates Apple Info.plist files\n// Example file:\n/*\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n\t<key>BuildMachineOSBuild</key>\n\t<string>20F71</string>\n\t<key>CFBundleDevelopmentRegion</key>\n\t<string>en</string>\n\t<key>CFBundleExecutable</key>\n\t<string>WebView</string>\n\t<key>CFBundleIconFile</key>\n\t<string>AppIcon</string>\n\t<key>CFBundleIconName</key>\n\t<string>AppIcon</string>\n\t<key>CFBundleIdentifier</key>\n\t<string>org.turbowarp.webviews.mac</string>\n\t<key>CFBundleInfoDictionaryVersion</key>\n\t<string>6.0</string>\n\t<key>CFBundleName</key>\n\t<string>WebView</string>\n\t<key>CFBundlePackageType</key>\n\t<string>APPL</string>\n\t<key>CFBundleShortVersionString</key>\n\t<string>1.0</string>\n\t<key>CFBundleSupportedPlatforms</key>\n\t<array>\n\t\t<string>MacOSX</string>\n\t</array>\n\t<key>CFBundleVersion</key>\n\t<string>1</string>\n\t<key>DTCompiler</key>\n\t<string>com.apple.compilers.llvm.clang.1_0</string>\n\t<key>DTPlatformBuild</key>\n\t<string>12E507</string>\n\t<key>DTPlatformName</key>\n\t<string>macosx</string>\n\t<key>DTPlatformVersion</key>\n\t<string>11.3</string>\n\t<key>DTSDKBuild</key>\n\t<string>20E214</string>\n\t<key>DTSDKName</key>\n\t<string>macosx11.3</string>\n\t<key>DTXcode</key>\n\t<string>1251</string>\n\t<key>DTXcodeBuild</key>\n\t<string>12E507</string>\n\t<key>LSApplicationCategoryType</key>\n\t<string>public.app-category.games</string>\n\t<key>LSMinimumSystemVersion</key>\n\t<string>10.12</string>\n\t<key>NSMainStoryboardFile</key>\n\t<string>Main</string>\n\t<key>NSPrincipalClass</key>\n\t<string>NSApplication</string>\n</dict>\n</plist>\n*/\n\nconst xmlToValue = (node) => {\n  if (node.tagName === 'dict') {\n    const result = {};\n    for (const child of node.children) {\n      if (child.tagName === 'key') {\n        result[child.textContent] = xmlToValue(child.nextElementSibling);\n      }\n    }\n    return result;\n  } else if (node.tagName === 'array') {\n    return Array.from(node.children).map(xmlToValue);\n  } else if (node.tagName === 'string') {\n    return node.textContent;\n  }\n  console.warn('unknown plist xml', node);\n  return null;\n};\n\nconst valueToXml = (doc, value) => {\n  if (Array.isArray(value)) {\n    const node = doc.createElement('array');\n    for (const listItem of value) {\n      node.appendChild(valueToXml(doc, listItem));\n    }\n    return node;\n  } else if (typeof value === 'object') {\n    const node = doc.createElement('dict');\n    for (const [key, keyValue] of Object.entries(value)) {\n      const keyNode = doc.createElement('key');\n      keyNode.textContent = key;\n      const valueNode = valueToXml(doc, keyValue);\n      node.appendChild(keyNode);\n      node.appendChild(valueNode);\n    }\n    return node;\n  } else if (typeof value === 'string') {\n    const node = doc.createElement('string');\n    node.textContent = value;\n    return node;\n  }\n  console.warn('unknown plist value', value);\n  return valueToXml(doc, `${value}`);\n};\n\nexport const parsePlist = (string) => {\n  const xml = new DOMParser().parseFromString(string, 'text/xml');\n  const rootNode = xml.children[0];\n  const rootDict = rootNode.children[0];\n  return xmlToValue(rootDict);\n};\n\nexport const generatePlist = (values) => {\n  const xml = document.implementation.createDocument(null, \"plist\");\n  const rootNode = xml.documentElement;\n  rootNode.setAttribute('version', '1.0');\n  rootNode.appendChild(valueToXml(xml, values));\n  const serialized = new XMLSerializer().serializeToString(xml);\n  return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n${serialized}`;\n};\n","import EventTarget from '../common/event-target';\nimport createChecksumWorker from '../build/p4-worker-loader!./sha256'\nimport defaultIcon from './images/default-icon.png';\nimport {readAsArrayBuffer, readAsURL} from '../common/readers';\nimport largeAssets from './large-assets';\nimport xhr from './xhr';\nimport pngToAppleICNS from './icns';\nimport assetCache from './cache';\nimport {buildId, verifyBuildId} from './build-id';\nimport {encode, decode} from './base85';\nimport {parsePlist, generatePlist} from './plist';\nimport {APP_NAME, WEBSITE, COPYRIGHT_NOTICE} from './brand';\n\nconst PROGRESS_LOADED_SCRIPTS = 0.1;\n\n// Used by environments that fetch the entire compressed project before calling loadProject()\nconst PROGRESS_FETCHED_COMPRESSED = 0.75;\nconst PROGRESS_EXTRACTED_COMPRESSED = 0.98;\n\n// Used by environments that pass a project.json into loadProject() and fetch assets separately\nconst PROGRESS_FETCHED_PROJECT_JSON = 0.2;\nconst PROGRESS_FETCHED_ASSETS = 0.98;\n\nconst escapeXML = (v) => v.replace(/[\"'<>&]/g, (i) => {\n  switch (i) {\n    case '\"': return '&quot;';\n    case '\\'': return '&apos;';\n    case '<': return '&lt;';\n    case '>': return '&gt;';\n    case '&': return '&amp;';\n  }\n});\n\nconst removeUnnecessaryEmptyLines = (string) => string.split('\\n')\n  .filter((line, index, array) => {\n    if (index === 0 || index === array.length - 1) return true;\n    if (line.trim().length === 0 && array[index - 1].trim().length === 0) return false;\n    return true;\n  })\n  .join('\\n');\n\nconst sha256 = async (buffer) => {\n  const {worker, terminate} = createChecksumWorker();\n  const hash = await worker.sha256(buffer);\n  terminate();\n  return hash;\n};\n\nconst getJSZip = async () => (await import(/* webpackChunkName: \"jszip\" */ 'jszip')).default;\n\nconst setFileFast = (zip, path, data) => {\n  zip.files[path] = data;\n};\n\nconst interpolate = (a, b, t) => a + t * (b - a);\n\nconst getAppIcon = async (file) => {\n  if (!file) {\n    return xhr({\n      url: defaultIcon,\n      type: 'arraybuffer'\n    });\n  }\n  // Convert to PNG\n  if (file.type === 'image/png') {\n    return readAsArrayBuffer(file);\n  }\n  return new Promise((resolve, reject) => {\n    const url = URL.createObjectURL(file);\n    const image = new Image();\n    image.onload = () => {\n      image.onload = null;\n      image.onerror = null;\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        reject(new Error('Cannot get rendering context for icon conversion'));\n        return;\n      }\n      canvas.width = image.width;\n      canvas.height = image.height;\n      ctx.drawImage(image, 0, 0);\n      canvas.toBlob((blob) => {\n        URL.revokeObjectURL(url);\n        resolve(readAsArrayBuffer(blob));\n      });\n    };\n    image.onerror = () => {\n      image.onload = null;\n      image.onerror = null;\n      reject(new Error('Cannot load icon'));\n    };\n    image.src = url;\n  });\n};\n\nconst SELF_LICENSE = {\n  title: APP_NAME,\n  homepage: WEBSITE,\n  license: COPYRIGHT_NOTICE\n};\n\nconst SCRATCH_LICENSE = {\n  title: 'Scratch',\n  homepage: 'https://scratch.mit.edu/',\n  license: `Copyright (c) 2016, Massachusetts Institute of Technology\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n\n3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.`\n};\n\nconst ELECTRON_LICENSE = {\n  title: 'Electron',\n  homepage: 'https://www.electronjs.org/',\n  license: `Copyright (c) Electron contributors\nCopyright (c) 2013-2020 GitHub Inc.\n\nPermission is hereby granted, free of charge, to any person obtaining\na copy of this software and associated documentation files (the\n\"Software\"), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to\npermit persons to whom the Software is furnished to do so, subject to\nthe following conditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\nLIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\nOF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\nWITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.`\n};\n\nconst COPYRIGHT_HEADER = `/*!\nParts of this script are from the ${APP_NAME} <${WEBSITE}>, licensed as follows:\n${SELF_LICENSE.license}\n\nParts of this script are from Scratch <https://scratch.mit.edu/>, licensed as follows:\n${SCRATCH_LICENSE.license}\n*/\\n`;\n\nconst generateChromiumLicenseHTML = (licenses) => {\n  const style = `<style>body { font-family: sans-serif; }</style>`;\n  const pretext = `<h2>The following entries were added by the ${APP_NAME}</h2>`;\n  const convertedLicenses = licenses.map((({title, license, homepage}, index) => `\n<div class=\"product\">\n<span class=\"title\">${escapeXML(title)}</span>\n<span class=\"homepage\"><a href=\"${escapeXML(homepage)}\">homepage</a></span>\n<input type=\"checkbox\" hidden id=\"p4-${index}\">\n<label class=\"show\" for=\"p4-${index}\" tabindex=\"0\"></label>\n<div class=\"licence\">\n<pre>${escapeXML(license)}</pre>\n</div>\n</div>\n`));\n  return `${style}${pretext}${convertedLicenses.join('\\n')}`;\n};\n\nclass Packager extends EventTarget {\n  constructor () {\n    super();\n    this.project = null;\n    this.options = Packager.DEFAULT_OPTIONS();\n    this.aborted = false;\n  }\n\n  abort () {\n    if (!this.aborted) {\n      this.aborted = true;\n      this.dispatchEvent(new Event('abort'));\n    }\n  }\n\n  ensureNotAborted () {\n    if (this.aborted) {\n      throw new Error('Aborted');\n    }\n  }\n\n  async fetchLargeAsset (name) {\n    this.ensureNotAborted();\n    const asset = largeAssets[name];\n    if (!asset) {\n      throw new Error(`Invalid asset: ${name}`);\n    }\n    if (typeof __ASSETS__ !== 'undefined' && __ASSETS__[asset.src]) {\n      return __ASSETS__[asset.src];\n    }\n    const dispatchProgress = (progress) => this.dispatchEvent(new CustomEvent('large-asset-fetch', {\n      detail: {\n        asset: name,\n        progress\n      }\n    }));\n    dispatchProgress(0);\n    let result;\n    let cameFromCache = false;\n    try {\n      const cached = await assetCache.get(asset);\n      if (cached) {\n        result = cached;\n        cameFromCache = true;\n        dispatchProgress(0.5);\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n    if (!result) {\n      let url = asset.src;\n      if (asset.useBuildId) {\n        url += `?${buildId}`;\n      }\n      result = await xhr({\n        url,\n        type: asset.type,\n        estimatedSize: asset.estimatedSize,\n        progressCallback: (progress) => {\n          dispatchProgress(progress);\n        },\n        abortTarget: this\n      });\n    }\n    if (asset.useBuildId && !verifyBuildId(buildId, result)) {\n      throw new Error('Build ID mismatch; This should be fixed after refreshing the page.');\n    }\n    if (asset.sha256) {\n      const hash = await sha256(result);\n      if (hash !== asset.sha256) {\n        throw new Error(`Hash mismatch for ${name}, found ${hash} but expected ${asset.sha256}`);\n      }\n    }\n    if (!cameFromCache) {\n      try {\n        await assetCache.set(asset, result);\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n    dispatchProgress(1);\n    return result;\n  }\n\n  getAddonOptions () {\n    return {\n      ...this.options.chunks,\n      specialCloudBehaviors: this.options.cloudVariables.specialCloudBehaviors,\n      pause: this.options.controls.pause.enabled\n    };\n  }\n\n  async loadResources () {\n    const texts = [COPYRIGHT_HEADER];\n    if (this.project.analysis.usesMusic) {\n      texts.push(await this.fetchLargeAsset('scaffolding'));\n    } else {\n      texts.push(await this.fetchLargeAsset('scaffolding-min'));\n    }\n    if (Object.values(this.getAddonOptions()).some((i) => i)) {\n      texts.push(await this.fetchLargeAsset('addons'));\n    }\n    this.script = texts.join('\\n').replace(/<\\/script>/g,\"</scri'+'pt>\");\n  }\n\n  computeWindowSize () {\n    let width = this.options.stageWidth;\n    let height = this.options.stageHeight;\n    if (\n      this.options.controls.greenFlag.enabled ||\n      this.options.controls.stopAll.enabled ||\n      this.options.controls.pause.enabled\n    ) {\n      height += 48;\n    }\n    return {width, height};\n  }\n\n  async addNwJS (projectZip) {\n    const nwjsBuffer = await this.fetchLargeAsset(this.options.target);\n    const nwjsZip = await (await getJSZip()).loadAsync(nwjsBuffer);\n\n    const isWindows = this.options.target.startsWith('nwjs-win');\n    const isMac = this.options.target === 'nwjs-mac';\n    const isLinux = this.options.target.startsWith('nwjs-linux');\n\n    // NW.js Windows folder structure:\n    // * (root)\n    // +-- nwjs-v0.49.0-win-x64\n    //   +-- nw.exe (executable)\n    //   +-- credits.html\n    //   +-- (project data)\n    //   +-- ...\n\n    // NW.js macOS folder structure:\n    // * (root)\n    // +-- nwjs-v0.49.0-osx-64\n    //   +-- credits.html\n    //   +-- nwjs.app\n    //     +-- Contents\n    //       +-- Resources\n    //         +-- app.icns (icon)\n    //         +-- app.nw\n    //           +-- (project data)\n    //       +-- MacOS\n    //         +-- nwjs (executable)\n    //       +-- ...\n\n    // the first folder, something like \"nwjs-v0.49.0-win-64\"\n    const nwjsPrefix = Object.keys(nwjsZip.files)[0].split('/')[0];\n\n    const zip = new (await getJSZip());\n\n    const packageName = this.options.app.packageName;\n\n    // Copy NW.js files to the right place\n    for (const path of Object.keys(nwjsZip.files)) {\n      const file = nwjsZip.files[path];\n\n      let newPath = path.replace(nwjsPrefix, packageName);\n      if (isWindows) {\n        newPath = newPath.replace('nw.exe', `${packageName}.exe`);\n      } else if (isMac) {\n        newPath = newPath.replace('nwjs.app', `${packageName}.app`);\n      } else if (isLinux) {\n        newPath = newPath.replace(/nw$/, packageName);\n      }\n\n      setFileFast(zip, newPath, file);\n    }\n\n    const ICON_NAME = 'icon.png';\n    const icon = await getAppIcon(this.options.app.icon);\n    const manifest = {\n      name: packageName,\n      main: 'main.js',\n      window: {\n        width: this.computeWindowSize().width,\n        height: this.computeWindowSize().height,\n        icon: ICON_NAME\n      }\n    };\n\n    let dataPrefix;\n    if (isWindows) {\n      dataPrefix = `${packageName}/`;\n    } else if (isMac) {\n      const icnsData = await pngToAppleICNS(icon);\n      zip.file(`${packageName}/${packageName}.app/Contents/Resources/app.icns`, icnsData);\n      dataPrefix = `${packageName}/${packageName}.app/Contents/Resources/app.nw/`;\n    } else if (isLinux) {\n      const startScript = `#!/bin/bash\ncd \"$(dirname \"$0\")\"\n./${packageName}`;\n      zip.file(`${packageName}/start.sh`, startScript, {\n        unixPermissions: 0o100755\n      });\n      dataPrefix = `${packageName}/`;\n    }\n\n    // Copy project files and extra NW.js files to the right place\n    for (const path of Object.keys(projectZip.files)) {\n      setFileFast(zip, dataPrefix + path, projectZip.files[path]);\n    }\n    zip.file(dataPrefix + ICON_NAME, icon);\n    zip.file(dataPrefix + 'package.json', JSON.stringify(manifest, null, 4));\n    zip.file(dataPrefix + 'main.js', `\n    const start = () => nw.Window.open('index.html', {\n      position: 'center',\n      new_instance: true\n    });\n    nw.App.on('open', start);\n    start();`);\n\n    const creditsHtmlPath = `${packageName}/credits.html`;\n    const creditsHtml = await zip.file(creditsHtmlPath).async('string');\n    zip.file(creditsHtmlPath, creditsHtml + generateChromiumLicenseHTML([\n      SELF_LICENSE,\n      SCRATCH_LICENSE\n    ]));\n\n    return zip;\n  }\n\n  async addElectron (projectZip) {\n    const buffer = await this.fetchLargeAsset(this.options.target);\n    const electronZip = await (await getJSZip()).loadAsync(buffer);\n\n    const isWindows = this.options.target.includes('win');\n    const isLinux = this.options.target.includes('linux');\n\n    // Electron Windows/Linux folder structure:\n    // * (root)\n    // +-- electron.exe (executable)\n    // +-- LICENSES.chromium.html\n    // +-- ...\n\n    const zip = new (await getJSZip());\n    const packageName = this.options.app.packageName;\n    for (const path of Object.keys(electronZip.files)) {\n      const file = electronZip.files[path];\n      // Create an inner folder inside the zip\n      let newPath = `${packageName}/${path}`;\n      // Rename the executable file\n      if (isWindows) {\n        newPath = newPath.replace('electron.exe', `${packageName}.exe`);\n      } else if (isLinux) {\n        newPath = newPath.replace(/electron$/, packageName);\n      }\n      setFileFast(zip, newPath, file);\n    }\n\n    const creditsHtml = await zip.file(`${packageName}/LICENSES.chromium.html`).async('string');\n    zip.file(`${packageName}/licenses.html`, creditsHtml + generateChromiumLicenseHTML([\n      SELF_LICENSE,\n      SCRATCH_LICENSE,\n      ELECTRON_LICENSE\n    ]));\n\n    zip.remove(`${packageName}/LICENSE.txt`);\n    zip.remove(`${packageName}/LICENSES.chromium.html`);\n    zip.remove(`${packageName}/LICENSE`);\n    zip.remove(`${packageName}/version`);\n    zip.remove(`${packageName}/resources/default_app.asar`);\n\n    const dataPrefix = `${packageName}/`;\n    const resourcePrefix = `${dataPrefix}resources/app/`;\n    const electronMainName = 'electron-main.js';\n    const iconName = 'icon.png';\n\n    const icon = await getAppIcon(this.options.app.icon);\n    zip.file(`${resourcePrefix}${iconName}`, icon);\n\n    const manifest = {\n      name: packageName,\n      main: electronMainName\n    };\n    zip.file(`${resourcePrefix}package.json`, JSON.stringify(manifest));\n\n    const mainJS = `'use strict';\nconst {app, BrowserWindow, Menu, shell, screen} = require('electron');\nconst path = require('path');\n\nconst isWindows = process.platform === 'win32';\nconst isMac = process.platform === 'darwin';\nconst isLinux = process.platform === 'linux';\n\nif (isMac) {\n  // TODO\n  Menu.setApplicationMenu(Menu.buildFromTemplate([\n    { role: 'appMenu' },\n    { role: 'fileMenu' },\n    { role: 'editMenu' },\n    { role: 'viewMenu' },\n    { role: 'windowMenu' },\n    { role: 'help' }\n  ]));\n} else {\n  Menu.setApplicationMenu(null);\n}\n\nconst isSafeOpenExternal = (url) => {\n  try {\n    const parsedUrl = new URL(url);\n    return parsedUrl.protocol === 'https:' || parsedUrl.protocol === 'http:';\n  } catch (e) {\n    // ignore\n  }\n  return false;\n};\n\nconst createWindow = () => {\n  const options = {\n    backgroundColor: ${JSON.stringify(this.options.appearance.background)},\n    width: ${this.computeWindowSize().width},\n    height: ${this.computeWindowSize().height},\n    title: ${JSON.stringify(this.options.app.windowTitle)},\n    useContentSize: true,\n    minWidth: 50,\n    minHeight: 50,\n    icon: path.resolve(__dirname, ${JSON.stringify(iconName)}),\n    webPreferences: {\n      contextIsolation: true,\n      nodeIntegration: false,\n      sandbox: true\n    },\n    show: true\n  };\n\n  const activeScreen = screen.getDisplayNearestPoint(screen.getCursorScreenPoint());\n  const bounds = activeScreen.workArea;\n  options.x = bounds.x + ((bounds.width - options.width) / 2);\n  options.y = bounds.y + ((bounds.height - options.height) / 2);\n\n  const window = new BrowserWindow(options);\n  window.loadFile(path.resolve(__dirname, './index.html'));\n};\n\napp.enableSandbox();\n\napp.on('web-contents-created', (event, contents) => {\n  contents.setWindowOpenHandler((details) => {\n    if (isSafeOpenExternal(details.url)) {\n      setImmediate(() => {\n        shell.openExternal(details.url);\n      });\n    }\n    return {action: 'deny'};\n  });\n  contents.on('will-navigate', (e, url) => {\n    e.preventDefault();\n    if (isSafeOpenExternal(url)) {\n      shell.openExternal(url);\n    }\n  });\n});\n\napp.on('window-all-closed', () => {\n  app.quit();\n});\n\napp.whenReady().then(() => {\n  createWindow();\n  app.on('activate', () => {\n    if (BrowserWindow.getAllWindows().length === 0) createWindow();\n  });\n});\n`;\n    zip.file(`${resourcePrefix}${electronMainName}`, mainJS);\n\n    for (const [path, data] of Object.entries(projectZip.files)) {\n      setFileFast(zip, `${resourcePrefix}${path}`, data);\n    }\n\n    if (isWindows) {\n      const readme = `Open \"${packageName}.exe\" to start the app. Open \"licenses.html\" for information regarding software licenses used by the app.`;\n      zip.file(`${dataPrefix}README.txt`, readme);\n    } else if (isLinux) {\n      // Some Linux distributions can't easily open the executable file from the GUI, so we'll add a simple wrapper that people can use instead.\n      const startScript = `#!/bin/bash\ncd \"$(dirname \"$0\")\"\n./${packageName}`;\n      zip.file(`${dataPrefix}start.sh`, startScript, {\n        unixPermissions: 0o100755\n      });\n    }\n\n    return zip;\n  }\n\n  async addWebViewMac (projectZip) {\n    const buffer = await this.fetchLargeAsset(this.options.target);\n    const appZip = await (await getJSZip()).loadAsync(buffer);\n\n    // +-- WebView.app\n    //   +-- Contents\n    //     +-- Info.plist\n    //     +-- MacOS\n    //       +-- WebView (executable)\n    //     +-- Resources\n    //       +-- index.html\n    //       +-- application_config.json\n    //       +-- AppIcon.icns\n\n    const newAppName = `${this.options.app.packageName}.app`;\n    const contentsPrefix = `${newAppName}/Contents/`;\n    const resourcePrefix = `${newAppName}/Contents/Resources/`;\n\n    const zip = new (await getJSZip());\n    for (const [path, data] of Object.entries(appZip.files)) {\n      const newPath = path\n        // Rename the .app itself\n        .replace('WebView.app', newAppName)\n        // Rename the executable\n        .replace(/WebView$/, this.options.app.packageName);\n      setFileFast(zip, newPath, data);\n    }\n    for (const [path, data] of Object.entries(projectZip.files)) {\n      setFileFast(zip, `${resourcePrefix}${path}`, data);\n    }\n\n    const icon = await getAppIcon(this.options.app.icon);\n    const icns = await pngToAppleICNS(icon);\n    zip.file(`${resourcePrefix}AppIcon.icns`, icns);\n    zip.remove(`${resourcePrefix}Assets.car`);\n\n    const parsedBackgroundColor = parseInt(this.options.appearance.background.substr(1), 16);\n    const applicationConfig = {\n      title: this.options.app.windowTitle,\n      background: [\n        // R, G, B [0-255]\n        parsedBackgroundColor >> 16 & 0xff,\n        parsedBackgroundColor >> 8 & 0xff,\n        parsedBackgroundColor & 0xff,\n        // A [0-1]\n        1\n      ],\n      width: this.computeWindowSize().width,\n      height: this.computeWindowSize().height\n    };\n    zip.file(`${resourcePrefix}application_config.json`, JSON.stringify(applicationConfig));\n\n    const plist = parsePlist(await zip.file(`${contentsPrefix}Info.plist`).async('string'));\n    // If CFBundleIdentifier changes, then things like saved local cloud variables will be reset.\n    plist.CFBundleIdentifier = `org.turbowarp.packager.userland.${this.options.app.packageName}`;\n    plist.CFBundleName = this.options.app.windowTitle;\n    plist.CFBundleExecutable = this.options.app.packageName;\n    // TODO: update LSApplicationCategoryType\n    zip.file(`${contentsPrefix}Info.plist`, generatePlist(plist));\n\n    return zip;\n  }\n\n  makeWebSocketProvider () {\n    return `new Scaffolding.Cloud.WebSocketProvider(${JSON.stringify(this.options.cloudVariables.cloudHost)}, ${JSON.stringify(this.options.projectId)})`;\n  }\n\n  makeLocalStorageProvider () {\n    return `new Scaffolding.Cloud.LocalStorageProvider(${JSON.stringify(`cloudvariables:${this.options.projectId}`)})`;\n  }\n\n  makeCustomProvider () {\n    const variables = this.options.cloudVariables.custom;\n    let result = '{const providers = {};\\n';\n    for (const provider of new Set(Object.values(variables))) {\n      if (provider === 'ws') {\n        result += `providers.ws = ${this.makeWebSocketProvider()};\\n`;\n      } else if (provider === 'local') {\n        result += `providers.local = ${this.makeLocalStorageProvider()};\\n`;\n      }\n    }\n    result += 'for (const provider of Object.values(providers)) scaffolding.addCloudProvider(provider);\\n';\n    for (const variableName of Object.keys(variables)) {\n      const providerToUse = variables[variableName];\n      result += `scaffolding.addCloudProviderOverride(${JSON.stringify(variableName)}, providers[${JSON.stringify(providerToUse)}] || null);\\n`;\n    }\n    result += '}';\n    return result;\n  }\n\n  generateFilename (extension) {\n    return `${this.options.app.windowTitle}.${extension}`;\n  }\n\n  async generateGetProjectData () {\n    let result = '';\n    let getProjectDataFunction = '';\n    let isZip = false;\n    let storageProgressStart;\n    let storageProgressEnd;\n\n    if (this.options.target === 'html') {\n      isZip = this.project.type !== 'blob';\n      storageProgressStart = PROGRESS_FETCHED_COMPRESSED;\n      storageProgressEnd = PROGRESS_EXTRACTED_COMPRESSED;\n\n      // We break the project into a bunch of small segments to be able to show a good progress bar.\n      const SEGMENT_LENGTH = 100000;\n      const arrayBuffer = await readAsArrayBuffer(this.project.blob);\n      const encoded = encode(arrayBuffer);\n      for (let i = 0; i < encoded.length; i += SEGMENT_LENGTH) {\n        const segment = encoded.substr(i, SEGMENT_LENGTH);\n        const progress = interpolate(PROGRESS_LOADED_SCRIPTS, PROGRESS_FETCHED_COMPRESSED, i / encoded.length);\n        // Progress will always be a number between 0 and 1. We can remove the leading 0 and unnecessary decimals to save space.\n        const shortenedProgress = progress.toString().substr(1, 4);\n        result += `<script type=\"p4-project\">${segment}</script><script>setProgress(${shortenedProgress})</script>`;\n      }\n\n      getProjectDataFunction = `async () => {\n        const base85decode = ${decode};\n        const dataElements = Array.from(document.querySelectorAll('script[type=\"p4-project\"]'));\n        const result = base85decode(dataElements.map(i => i.textContent).join(''));\n        dataElements.forEach(i => i.remove());\n        return result;\n      }`;\n    } else {\n      let src;\n      if (this.project.type === 'blob' || this.options.target === 'zip-one-asset') {\n        isZip = true;\n        src = './project.zip';\n        storageProgressStart = PROGRESS_FETCHED_COMPRESSED;\n        storageProgressEnd = PROGRESS_EXTRACTED_COMPRESSED;\n      } else {\n        src = './assets/project.json';\n        storageProgressStart = PROGRESS_FETCHED_PROJECT_JSON;\n        storageProgressEnd = PROGRESS_FETCHED_ASSETS;\n      }\n\n      getProjectDataFunction = `() => new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        xhr.onload = () => {\n          resolve(xhr.response);\n        };\n        xhr.onerror = () => {\n          if (location.protocol === 'file:') {\n            reject(new Error('Zip environment must be used from a website, not from a file URL.'));\n          } else {\n            reject(new Error('Request to load project data failed.'));\n          }\n        };\n        xhr.onprogress = (e) => {\n          if (e.lengthComputable) {\n            setProgress(interpolate(${PROGRESS_LOADED_SCRIPTS}, ${storageProgressStart}, e.loaded / e.total));\n          }\n        };\n        xhr.responseType = 'arraybuffer';\n        xhr.open('GET', ${JSON.stringify(src)});\n        xhr.send();\n      })`;\n    }\n\n    result += `\n    <script>\n      const getProjectData = (function() {\n        const storage = scaffolding.storage;\n        storage.onprogress = (total, loaded) => {\n          setProgress(interpolate(${storageProgressStart}, ${storageProgressEnd}, loaded / total));\n        };\n        ${isZip ? `\n        storage.addHelper({\n          load: (assetType, assetId, dataFormat) => zip.file(assetId + '.' + dataFormat)\n            .async('uint8array')\n            .then((data) => new storage.Asset(assetType, assetId, dataFormat, data))\n        });\n        return () => (${getProjectDataFunction})().then(async (data) => {\n          zip = await Scaffolding.JSZip.loadAsync(data);\n          return zip.file('project.json').async('arraybuffer');\n        });` : `\n        storage.addWebStore(\n          [storage.AssetType.ImageVector, storage.AssetType.ImageBitmap, storage.AssetType.Sound],\n          (asset) => new URL('./assets/' + asset.assetId + '.' + asset.dataFormat, location).href\n        );\n        return ${getProjectDataFunction};`}\n      })();\n    </script>`;\n    return result;\n  }\n\n  async generateFavicon () {\n    if (this.options.app.icon === null) {\n      return '';\n    }\n    const data = await readAsURL(this.options.app.icon);\n    return `<link rel=\"icon\" href=\"${data}\">`;\n  }\n\n  async generateCursor () {\n    if (this.options.cursor.type !== 'custom') {\n      return this.options.cursor.type;\n    }\n    if (!this.options.cursor.custom) {\n      // Set to custom but no data, so ignore\n      return 'auto';\n    }\n    const data = await readAsURL(this.options.cursor.custom);\n    return `url(${data}), auto`;\n  }\n\n  async package () {\n    this.ensureNotAborted();\n    await this.loadResources();\n    this.ensureNotAborted();\n    const html = `<!DOCTYPE html>\n<!-- Created with ${WEBSITE} -->\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n  <!-- We only include this to explicitly loosen the CSP of various packager environments. It does not provide any security. -->\n  <meta http-equiv=\"Content-Security-Policy\" content=\"default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: blob:\">\n  <title>${escapeXML(this.options.app.windowTitle)}</title>\n  <style>\n    body {\n      color: ${this.options.appearance.foreground};\n      font-family: sans-serif;\n      overflow: hidden;\n      margin: 0;\n      padding: 0;\n    }\n    :root, body.is-fullscreen {\n      background-color: ${this.options.appearance.background};\n    }\n    [hidden] {\n      display: none !important;\n    }\n    h1 {\n      font-weight: normal;\n    }\n    a {\n      color: inherit;\n      text-decoration: underline;\n      cursor: pointer;\n    }\n\n    #app, #loading, #error, #launch {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n    }\n    .screen {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      text-align: center;\n      cursor: default;\n      user-select: none;\n      -webkit-user-select: none;\n      background-color: ${this.options.appearance.background};\n    }\n    #launch {\n      background-color: rgba(0, 0, 0, 0.7);\n      cursor: pointer;\n    }\n    .green-flag {\n      width: 80px;\n      height: 80px;\n      padding: 16px;\n      border-radius: 100%;\n      background: rgba(255, 255, 255, 0.75);\n      border: 3px solid hsla(0, 100%, 100%, 1);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      box-sizing: border-box;\n    }\n    #loading {\n      ${this.options.loadingScreen.image && this.options.loadingScreen.imageMode === 'stretch'\n        ? `background-image: url(${await readAsURL(this.options.loadingScreen.image)});\n      background-repeat: no-repeat;\n      background-size: contain;\n      background-position: center;`\n        : ''}\n    }\n    .progress-bar-outer {\n      border: 1px solid currentColor;\n      height: 10px;\n      width: 200px;\n      max-width: 200px;\n    }\n    .progress-bar-inner {\n      height: 100%;\n      width: 0;\n      background-color: currentColor;\n    }\n    .loading-text {\n      font-weight: normal;\n      font-size: 36px;\n      margin: 0 0 16px;\n    }\n    .loading-image {\n      margin: 0 0 16px;\n    }\n    #error-message, #error-stack {\n      font-family: monospace;\n      max-width: 600px;\n      white-space: pre-wrap;\n      user-select: text;\n      -webkit-user-select: text;\n    }\n    #error-stack {\n      text-align: left;\n      max-height: 200px;\n      overflow: auto;\n    }\n    .control-button {\n      width: 2rem;\n      height: 2rem;\n      padding: 0.375rem;\n      border-radius: 0.25rem;\n      margin-top: 0.5rem;\n      margin-bottom: 0.5rem;\n      user-select: none;\n      -webkit-user-select: none;\n      cursor: pointer;\n      border: 0;\n      border-radius: 4px;\n    }\n    .control-button:hover {\n      background: ${this.options.appearance.accent}26;\n    }\n    .control-button.active {\n      background: ${this.options.appearance.accent}59;\n    }\n    .fullscreen-button {\n      background: white !important;\n    }\n    .standalone-fullscreen-button {\n      position: absolute;\n      top: 0;\n      right: 0;\n      background-color: rgba(0, 0, 0, 0.5);\n      border-radius: 0 0 0 4px;\n      padding: 4px;\n      cursor: pointer;\n    }\n    .sc-canvas {\n      cursor: ${await this.generateCursor()};\n    }\n    ${this.options.custom.css}\n  </style>\n  <meta name=\"theme-color\" content=\"${this.options.appearance.background}\">\n  ${await this.generateFavicon()}\n</head>\n<body>\n  <noscript>Enable JavaScript</noscript>\n\n  <div id=\"app\"></div>\n\n  <div id=\"launch\" class=\"screen\" hidden title=\"Click to start\">\n    <div class=\"green-flag\">\n      <svg viewBox=\"0 0 16.63 17.5\" width=\"42\" height=\"44\">\n        <defs><style>.cls-1,.cls-2{fill:#4cbf56;stroke:#45993d;stroke-linecap:round;stroke-linejoin:round;}.cls-2{stroke-width:1.5px;}</style></defs>\n        <path class=\"cls-1\" d=\"M.75,2A6.44,6.44,0,0,1,8.44,2h0a6.44,6.44,0,0,0,7.69,0V12.4a6.44,6.44,0,0,1-7.69,0h0a6.44,6.44,0,0,0-7.69,0\"/>\n        <line class=\"cls-2\" x1=\"0.75\" y1=\"16.75\" x2=\"0.75\" y2=\"0.75\"/>\n      </svg>\n    </div>\n  </div>\n\n  <div id=\"loading\" class=\"screen\">\n    ${this.options.loadingScreen.text ? `<h1 class=\"loading-text\">${escapeXML(this.options.loadingScreen.text)}</h1>` : ''}\n    ${this.options.loadingScreen.image && this.options.loadingScreen.imageMode === 'normal' ? `<div class=\"loading-image\"><img src=\"${await readAsURL(this.options.loadingScreen.image)}\"></div>` : ''}\n    ${this.options.loadingScreen.progressBar ? '<div class=\"progress-bar-outer\"><div class=\"progress-bar-inner\" id=\"loading-inner\"></div></div>' : ''}\n  </div>\n\n  <div id=\"error\" class=\"screen\" hidden>\n    <h1>Error</h1>\n    <details>\n      <summary id=\"error-message\"></summary>\n      <p id=\"error-stack\"></p>\n    </details>\n  </div>\n\n  ${this.options.target === 'html' ? `<script>${this.script}</script>` : '<script src=\"script.js\"></script>'}\n  <script>${removeUnnecessaryEmptyLines(`\n    const appElement = document.getElementById('app');\n    const launchScreen = document.getElementById('launch');\n    const loadingScreen = document.getElementById('loading');\n    const loadingInner = document.getElementById('loading-inner');\n    const errorScreen = document.getElementById('error');\n    const errorScreenMessage = document.getElementById('error-message');\n    const errorScreenStack = document.getElementById('error-stack');\n\n    const handleError = (error) => {\n      console.error(error);\n      if (!errorScreen.hidden) return;\n      errorScreen.hidden = false;\n      errorScreenMessage.textContent = '' + error;\n      let debug = error && error.stack || 'no stack';\n      debug += '\\\\nUser agent: ' + navigator.userAgent;\n      errorScreenStack.textContent = debug;\n    };\n    const setProgress = (progress) => {\n      if (loadingInner) loadingInner.style.width = progress * 100 + '%';\n    };\n    const interpolate = (a, b, t) => a + t * (b - a);\n\n    try {\n      setProgress(${PROGRESS_LOADED_SCRIPTS});\n\n      const scaffolding = new Scaffolding.Scaffolding();\n      scaffolding.width = ${this.options.stageWidth};\n      scaffolding.height = ${this.options.stageHeight};\n      scaffolding.resizeMode = ${JSON.stringify(this.options.resizeMode)};\n      scaffolding.editableLists = ${this.options.monitors.editableLists};\n      scaffolding.setup();\n      scaffolding.appendTo(appElement);\n\n      window.scaffolding = scaffolding;\n      window.vm = scaffolding.vm;\n      const vm = scaffolding.vm;\n\n      scaffolding.setUsername(${JSON.stringify(this.options.username)}.replace(/#/g, () => Math.floor(Math.random() * 10)));\n      scaffolding.setAccentColor(${JSON.stringify(this.options.appearance.accent)});\n\n      ${this.options.cloudVariables.mode === 'ws' ?\n        `scaffolding.addCloudProvider(${this.makeWebSocketProvider()})` :\n        this.options.cloudVariables.mode === 'local' ?\n        `scaffolding.addCloudProvider(${this.makeLocalStorageProvider()})` :\n        this.options.cloudVariables.mode === 'custom' ?\n        this.makeCustomProvider() :\n        ''\n      };\n\n      ${this.options.controls.greenFlag.enabled ? `\n      const greenFlagButton = document.createElement('img');\n      greenFlagButton.src = 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16.63 17.5\"><path d=\"M.75 2a6.44 6.44 0 017.69 0h0a6.44 6.44 0 007.69 0v10.4a6.44 6.44 0 01-7.69 0h0a6.44 6.44 0 00-7.69 0\" fill=\"#4cbf56\" stroke=\"#45993d\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path stroke-width=\"1.5\" fill=\"#4cbf56\" stroke=\"#45993d\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M.75 16.75v-16\"/></svg>');\n      greenFlagButton.className = 'control-button';\n      greenFlagButton.addEventListener('click', () => {\n        scaffolding.greenFlag();\n      });\n      scaffolding.addEventListener('PROJECT_RUN_START', () => {\n        greenFlagButton.classList.add('active');\n      });\n      scaffolding.addEventListener('PROJECT_RUN_STOP', () => {\n        greenFlagButton.classList.remove('active');\n      });\n      scaffolding.addControlButton({\n        element: greenFlagButton,\n        where: 'top-left'\n      });` : ''}\n\n      ${this.options.controls.pause.enabled ? `\n      const pauseButton = document.createElement('img');\n      pauseButton.className = 'control-button';\n      let isPaused = false;\n      pauseButton.addEventListener('click', () => {\n        isPaused = !isPaused;\n        vm.setPaused(isPaused);\n      });\n      const updatePause = () => {\n        if (isPaused) {\n          pauseButton.src = 'data:image/svg+xml,' + encodeURIComponent('<svg width=\"16\" height=\"16\" viewBox=\"0 0 4.2333332 4.2333335\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m3.95163484 2.02835365-1.66643921.9621191-1.66643913.96211911V.10411543l1.66643922.9621191z\" fill=\"#ffae00\"/></svg>');\n        } else {\n          pauseButton.src = 'data:image/svg+xml,' + encodeURIComponent('<svg width=\"16\" height=\"16\" viewBox=\"0 0 4.2333332 4.2333335\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#ffae00\"><path d=\"M.389.19239126h1.2631972v3.8485508H.389zM2.5810001.19239126h1.2631972v3.8485508H2.5810001z\"/></g></svg>');\n        }\n      }\n      vm.on('P4_PAUSE', updatePause);\n      updatePause();\n      scaffolding.addControlButton({\n        element: pauseButton,\n        where: 'top-left'\n      });` : ''}\n\n      ${this.options.controls.stopAll.enabled ? `\n      const stopAllButton = document.createElement('img');\n      stopAllButton.src = 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14 14\"><path fill=\"#ec5959\" stroke=\"#b84848\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" d=\"M4.3.5h5.4l3.8 3.8v5.4l-3.8 3.8H4.3L.5 9.7V4.3z\"/></svg>');\n      stopAllButton.className = 'control-button';\n      stopAllButton.addEventListener('click', () => {\n        scaffolding.stopAll();\n      });\n      scaffolding.addControlButton({\n        element: stopAllButton,\n        where: 'top-left'\n      });` : ''}\n\n      ${this.options.controls.fullscreen.enabled ? `\n      if (document.fullscreenEnabled || document.webkitFullscreenEnabled) {\n        let isFullScreen = !!(document.fullscreenElement || document.webkitFullscreenElement);\n        const fullscreenButton = document.createElement('img');\n        fullscreenButton.className = 'control-button fullscreen-button';\n        fullscreenButton.addEventListener('click', () => {\n          if (isFullScreen) {\n            if (document.exitFullscreen) {\n              document.exitFullscreen();\n            } else if (document.webkitExitFullscreen) {\n              document.webkitExitFullscreen();\n            }\n          } else {\n            if (document.body.requestFullscreen) {\n              document.body.requestFullscreen();\n            } else if (document.body.webkitRequestFullscreen) {\n              document.body.webkitRequestFullscreen();\n            }\n          }\n        });\n        const otherControlsExist = ${this.options.controls.greenFlag.enabled || this.options.controls.stopAll.enabled};\n        const fillColor = otherControlsExist ? '#575E75' : '${this.options.appearance.foreground}';\n        const updateFullScreen = () => {\n          isFullScreen = !!(document.fullscreenElement || document.webkitFullscreenElement);\n          document.body.classList.toggle('is-fullscreen', isFullScreen);\n          if (isFullScreen) {\n            fullscreenButton.src = 'data:image/svg+xml,' + encodeURIComponent('<svg width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"' + fillColor + '\" fill-rule=\"evenodd\"><path d=\"M12.662 3.65l.89.891 3.133-2.374a.815.815 0 011.15.165.819.819 0 010 .986L15.467 6.46l.867.871c.25.25.072.664-.269.664L12.388 8A.397.397 0 0112 7.611V3.92c0-.341.418-.514.662-.27M7.338 16.35l-.89-.89-3.133 2.374a.817.817 0 01-1.15-.166.819.819 0 010-.985l2.37-3.143-.87-.871a.387.387 0 01.27-.664L7.612 12a.397.397 0 01.388.389v3.692a.387.387 0 01-.662.27M7.338 3.65l-.89.891-3.133-2.374a.815.815 0 00-1.15.165.819.819 0 000 .986l2.37 3.142-.87.871a.387.387 0 00.27.664L7.612 8A.397.397 0 008 7.611V3.92a.387.387 0 00-.662-.27M12.662 16.35l.89-.89 3.133 2.374a.817.817 0 001.15-.166.819.819 0 000-.985l-2.368-3.143.867-.871a.387.387 0 00-.269-.664L12.388 12a.397.397 0 00-.388.389v3.692c0 .342.418.514.662.27\"/></g></svg>');\n          } else {\n            fullscreenButton.src = 'data:image/svg+xml,' + encodeURIComponent('<svg width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"' + fillColor + '\" fill-rule=\"evenodd\"><path d=\"M16.338 7.35l-.89-.891-3.133 2.374a.815.815 0 01-1.15-.165.819.819 0 010-.986l2.368-3.142-.867-.871a.387.387 0 01.269-.664L16.612 3a.397.397 0 01.388.389V7.08a.387.387 0 01-.662.27M3.662 12.65l.89.89 3.133-2.374a.817.817 0 011.15.166.819.819 0 010 .985l-2.37 3.143.87.871c.248.25.071.664-.27.664L3.388 17A.397.397 0 013 16.611V12.92c0-.342.418-.514.662-.27M3.662 7.35l.89-.891 3.133 2.374a.815.815 0 001.15-.165.819.819 0 000-.986L6.465 4.54l.87-.871a.387.387 0 00-.27-.664L3.388 3A.397.397 0 003 3.389V7.08c0 .341.418.514.662.27M16.338 12.65l-.89.89-3.133-2.374a.817.817 0 00-1.15.166.819.819 0 000 .985l2.368 3.143-.867.871a.387.387 0 00.269.664l3.677.005a.397.397 0 00.388-.389V12.92a.387.387 0 00-.662-.27\"/></g></svg>');\n          }\n        };\n        updateFullScreen();\n        document.addEventListener('fullscreenchange', updateFullScreen);\n        document.addEventListener('webkitfullscreenchange', updateFullScreen);\n        if (otherControlsExist) {\n          fullscreenButton.className = 'control-button fullscreen-button';\n          scaffolding.addControlButton({\n            element: fullscreenButton,\n            where: 'top-right'\n          });\n        } else {\n          fullscreenButton.className = 'standalone-fullscreen-button';\n          document.body.appendChild(fullscreenButton);\n        }\n      }` : ''}\n\n      vm.setTurboMode(${this.options.turbo});\n      if (vm.setInterpolation) vm.setInterpolation(${this.options.interpolation});\n      if (vm.setFramerate) vm.setFramerate(${this.options.framerate});\n      if (vm.renderer.setUseHighQualityRender) vm.renderer.setUseHighQualityRender(${this.options.highQualityPen});\n      if (vm.setRuntimeOptions) vm.setRuntimeOptions({\n        fencing: ${this.options.fencing},\n        miscLimits: ${this.options.miscLimits},\n        maxClones: ${this.options.maxClones},\n      });\n      if (vm.setCompilerOptions) vm.setCompilerOptions({\n        enabled: ${this.options.compiler.enabled},\n        warpTimer: ${this.options.compiler.warpTimer}\n      });\n\n      if (typeof ScaffoldingAddons !== 'undefined') {\n        ScaffoldingAddons.run(scaffolding, ${JSON.stringify(this.getAddonOptions())});\n      }\n\n      for (const extension of ${JSON.stringify(this.options.extensions.map(i => i.url))}) {\n        vm.extensionManager.loadExtensionURL(extension);\n      }\n\n      ${this.options.target.startsWith('nwjs-') ? `\n      if (typeof nw !== 'undefined') {\n        const win = nw.Window.get();\n        win.on('new-win-policy', (frame, url, policy) => {\n          policy.ignore();\n          nw.Shell.openExternal(url);\n        });\n        win.on('navigation', (frame, url, policy) => {\n          policy.ignore();\n          nw.Shell.openExternal(url);\n        });\n        document.addEventListener('keydown', (e) => {\n          if (e.key === 'Escape' && document.fullscreenElement) {\n            document.exitFullscreen();\n          }\n        });\n      }` : ''}\n\n      ${this.options.target.startsWith('electron-') ? `\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'F11' || (e.key === 'Enter' && e.altKey)) {\n          e.preventDefault();\n          if (document.fullscreenElement) {\n            document.exitFullscreen();\n          } else {\n            document.body.requestFullscreen();\n          }\n        }\n      });` : ''}\n    } catch (e) {\n      handleError(e);\n    }\n  `)}</script>\n  <script>${this.options.custom.js}</script>\n  ${await this.generateGetProjectData()}\n  <script>\n    const run = async () => {\n      const projectData = await getProjectData();\n      await scaffolding.loadProject(projectData);\n      setProgress(1);\n      loadingScreen.hidden = true;\n      if (${this.options.autoplay}) {\n        scaffolding.start();\n      } else {\n        launchScreen.hidden = false;\n        launchScreen.addEventListener('click', () => {\n          launchScreen.hidden = true;\n          scaffolding.start();\n        });\n        launchScreen.focus();\n      }\n    };\n    run().catch(handleError);\n  </script>\n</body>\n</html>\n`;\n    this.ensureNotAborted();\n\n    if (this.options.target !== 'html') {\n      let zip;\n      if (this.project.type === 'sb3' && this.options.target !== 'zip-one-asset') {\n        zip = await (await getJSZip()).loadAsync(this.project.blob);\n        for (const file of Object.keys(zip.files)) {\n          zip.files[`assets/${file}`] = zip.files[file];\n          delete zip.files[file];\n        }\n      } else {\n        zip = new (await getJSZip());\n        zip.file('project.zip', this.project.blob);\n      }\n      zip.file('index.html', html);\n      zip.file('script.js', this.script);\n\n      if (this.options.target.startsWith('nwjs-')) {\n        zip = await this.addNwJS(zip);\n      } else if (this.options.target.startsWith('electron-')) {\n        zip = await this.addElectron(zip);\n      } else if (this.options.target === 'webview-mac') {\n        zip = await this.addWebViewMac(zip);\n      }\n\n      this.ensureNotAborted();\n      return {\n        blob: await zip.generateAsync({\n          type: 'blob',\n          compression: 'DEFLATE',\n          // Use UNIX permissions so that executable bits are properly set for macOS and Linux\n          platform: 'UNIX'\n        }, (meta) => {\n          this.dispatchEvent(new CustomEvent('zip-progress', {\n            detail: {\n              progress: meta.percent / 100\n            }\n          }));\n        }),\n        filename: this.generateFilename('zip')\n      };\n    }\n    return {\n      blob: new Blob([html], {\n        type: 'text/html'\n      }),\n      filename: this.generateFilename('html')\n    };\n  }\n}\n\nPackager.getDefaultPackageNameFromFileName = (title) => {\n  // Remove file extension\n  title = title.split('.')[0];\n  title = title.replace(/[^\\-a-z ]/gi, '');\n  title = title.trim();\n  title = title.replace(/ /g, '-');\n  return title.toLowerCase() || 'packaged-project';\n};\n\nPackager.getWindowTitleFromFileName = (title) => {\n  title = title.trim();\n  title = title.split('.')[0];\n  return title || 'Packaged Project';\n};\n\nPackager.DEFAULT_OPTIONS = () => ({\n  turbo: false,\n  interpolation: false,\n  framerate: 30,\n  highQualityPen: false,\n  maxClones: 300,\n  fencing: true,\n  miscLimits: true,\n  stageWidth: 480,\n  stageHeight: 360,\n  resizeMode: 'preserve-ratio',\n  autoplay: false,\n  username: 'player####',\n  custom: {\n    css: '',\n    js: ''\n  },\n  appearance: {\n    background: '#000000',\n    foreground: '#ffffff',\n    accent: '#ff4c4c'\n  },\n  loadingScreen: {\n    progressBar: true,\n    text: '',\n    imageMode: 'normal',\n    image: null\n  },\n  controls: {\n    greenFlag: {\n      enabled: false,\n    },\n    stopAll: {\n      enabled: false,\n    },\n    fullscreen: {\n      enabled: false\n    },\n    pause: {\n      enabled: false\n    }\n  },\n  monitors: {\n    editableLists: false\n  },\n  compiler: {\n    enabled: true,\n    warpTimer: false\n  },\n  target: 'html',\n  app: {\n    icon: null,\n    packageName: Packager.getDefaultPackageNameFromFileName(''),\n    windowTitle: Packager.getWindowTitleFromFileName('')\n  },\n  chunks: {\n    gamepad: false,\n    pointerlock: false,\n  },\n  cloudVariables: {\n    mode: 'ws',\n    id: 0,\n    cloudHost: 'wss://clouddata.turbowarp.org',\n    custom: {},\n    specialCloudBehaviors: false,\n  },\n  cursor: {\n    type: 'auto',\n    custom: null\n  },\n  extensions: []\n});\n\nexport default Packager;\n","<script>\n  import {onDestroy} from 'svelte';\n  import {_} from '../locales/';\n  import {slide, fade} from 'svelte/transition';\n  import Section from './Section.svelte';\n  import Button from '../p4/Button.svelte';\n  import ImageInput from './ImageInput.svelte';\n  import CustomExtensions from '../p4/CustomExtensions.svelte';\n  import LearnMore from './LearnMore.svelte';\n  import ColorPicker from './ColorPicker.svelte';\n  import writablePersistentStore from './persistent-store';\n  import fileStore from './file-store';\n  import {progress, currentTask} from './stores';\n  import Preview from './preview';\n  import deepClone from './deep-clone';\n  import Packager from '../packager/packager';\n  import Task from './task';\n\n  export let projectData;\n  export let title;\n\n  // JSON can't easily parse Infinity, so we'll just store large numbers instead\n  const ALMOST_INFINITY = 9999999999;\n\n  const cloudVariables = projectData.project.analysis.stageVariables\n    .filter(i => i.isCloud)\n    .map(i => i.name);\n\n  const defaultOptions = Packager.DEFAULT_OPTIONS();\n  defaultOptions.projectId = projectData.projectId || `p4-${projectData.uniqueId}`;\n  for (const variable of cloudVariables) {\n    defaultOptions.cloudVariables.custom[variable] = 'ws';\n  }\n  defaultOptions.app.packageName = Packager.getDefaultPackageNameFromFileName(projectData.title);\n  defaultOptions.app.windowTitle = Packager.getWindowTitleFromFileName(projectData.title);\n  const options = writablePersistentStore(`PackagerOptions.${projectData.uniqueId}`, defaultOptions);\n\n  const hasMagicComment = (magic) => projectData.project.analysis.stageComments.find(\n    (text) => text.split('\\n').find((line) => line.endsWith(magic))\n  );\n  const hasSettingsStoredInProject = hasMagicComment(' // _twconfig_');\n\n  let result = null;\n  let previewer = null;\n  const resetResult = () => {\n    previewer = null;\n    if (result) {\n      URL.revokeObjectURL(result.url);\n    }\n    result = null;\n  }\n  $: if (previewer) {\n    previewer.setProgress($progress.progress, $progress.text);\n  }\n  $: $options, resetResult(), currentTask.abort();\n\n  const icon = fileStore.writableFileStore(`PackagerOptions.icon.${projectData.uniqueId}`);\n  $: $options.app.icon = $icon;\n\n  const customCursorIcon = fileStore.writableFileStore(`PackagerOptions.customCursorIcon.${projectData.uniqueId}`);\n  $: $options.cursor.custom = $customCursorIcon;\n\n  const loadingScreenImage = fileStore.writableFileStore(`PackagerOptions.loadingScreenImage.${projectData.uniqueId}`);\n  $: $options.loadingScreen.image = $loadingScreenImage;\n\n  $: title = $options.app.windowTitle;\n\n  const otherEnvironmentsInitiallyOpen = ![\n    'html',\n    'zip',\n    'electron-win32',\n    'webview-mac',\n    'electron-linux64'\n  ].includes($options.target);\n\n  const downloadURL = (filename, url) => {\n    const link = document.createElement('a');\n    link.download = filename;\n    link.href = url;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n  };\n\n  const runPackager = async (task, options) => {\n    const packager = new Packager();\n    packager.options = options;\n    packager.project = projectData.project;\n\n    task.addEventListener('abort', () => {\n      packager.abort();\n    });\n\n    task.setProgressText($_('progress.loadingScripts'));\n\n    packager.addEventListener('large-asset-fetch', ({detail}) => {\n      let thing;\n      if (detail.asset.startsWith('nwjs-')) {\n        thing = 'NW.js';\n      } else if (detail.asset.startsWith('electron-')) {\n        thing = 'Electron';\n      } else if (detail.asset === 'webview-mac') {\n        thing = 'WKWebView';\n      }\n      if (thing) {\n        task.setProgressText($_('progress.loadingLargeAsset').replace('{thing}', thing));\n      }\n      task.setProgress(detail.progress);\n    });\n    packager.addEventListener('zip-progress', ({detail}) => {\n      task.setProgressText($_('progress.compressingProject'));\n      task.setProgress(detail.progress);\n    });\n\n    const result = await packager.package();\n    result.url = URL.createObjectURL(result.blob);\n    return result;\n  };\n\n  const pack = async () => {\n    resetResult();\n    const task = new Task();\n    result = await task.do(runPackager(task, deepClone($options)));\n    task.done();\n    downloadURL(result.filename, result.url);\n  };\n\n  const preview = async () => {\n    resetResult();\n    previewer = new Preview();\n    const task = new Task();\n    const optionsClone = deepClone($options);\n    optionsClone.target = 'html';\n    try {\n      result = await task.do(runPackager(task, optionsClone));\n      task.done();\n      previewer.setContent(result.blob);\n    } catch (e) {\n      previewer.close();\n    }\n  };\n\n  const resetOptions = (properties) => {\n    for (const key of properties) {\n      $options[key] = deepClone(defaultOptions[key]);\n    }\n  };\n\n  onDestroy(() => {\n    if (result) {\n      URL.revokeObjectURL(result.url);\n    }\n  });\n</script>\n\n<style>\n  label {\n    display: block;\n    margin-bottom: 4px;\n  }\n  input[type=number] {\n    width: 60px;\n  }\n  input[type=text] {\n    width: 150px;\n  }\n  textarea {\n    box-sizing: border-box;\n    width: 100%;\n    min-width: 100%;\n    height: 150px;\n  }\n  /* TODO: fix the option-group mess */\n  .option-group {\n    margin-bottom: 12px;\n  }\n  .stage-size-section {\n    margin-top: 12px;\n  }\n  input:invalid {\n    outline: 2px solid red;\n  }\n  .warning {\n    font-weight: bold;\n    background: yellow;\n    color: black;\n    padding: 10px;\n    border-radius: 10px;\n  }\n</style>\n\n<Section\n  accent=\"#FFAB19\"\n  reset={() => {\n    resetOptions([\n      'turbo',\n      'framerate',\n      'interpolation',\n      'highQualityPen',\n      'maxClones',\n      'fencing',\n      'miscLimits',\n      'stageWidth',\n      'stageHeight',\n      'resizeMode',\n      'username'\n    ]);\n  }}\n>\n  <div>\n    <h2>{$_('options.runtimeOptions')}</h2>\n\n    {#if hasSettingsStoredInProject}\n      <div class=\"option-group\">\n        {$_('options.storedWarning')}\n      </div>\n    {/if}\n\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.turbo}>\n      {$_('options.turbo')}\n    </label>\n    <label>\n      {$_('options.framerate')}\n      <input type=\"number\" min=\"0\" max=\"240\" bind:value={$options.framerate}>\n      <LearnMore slug=\"custom-fps\" />\n    </label>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.interpolation}>\n      {$_('options.interpolation')}\n      <LearnMore slug=\"interpolation\" />\n    </label>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.highQualityPen}>\n      {$_('options.highQualityPen')}\n      <LearnMore slug=\"high-quality-pen\" />\n    </label>\n    <label>\n      <input type=\"checkbox\" checked={$options.maxClones === ALMOST_INFINITY} on:change={(e) => {\n        $options.maxClones = e.target.checked ? ALMOST_INFINITY : 300;\n      }}>\n      {$_('options.infiniteClones')}\n      <LearnMore slug=\"infinite-clones\" />\n    </label>\n    <label>\n      <input type=\"checkbox\" checked={!$options.fencing} on:change={(e) => {\n        $options.fencing = !e.target.checked;\n      }}>\n      {$_('options.removeFencing')}\n      <LearnMore slug=\"remove-fencing\" />\n    </label>\n    <label>\n      <input type=\"checkbox\" checked={!$options.miscLimits} on:change={(e) => {\n        $options.miscLimits = !e.target.checked;\n      }}>\n      {$_('options.removeMiscLimits')}\n      <LearnMore slug=\"remove-misc-limits\" />\n    </label>\n    <label>\n      {$_('options.username')}\n      <input type=\"text\" bind:value={$options.username}>\n    </label>\n    <div class=\"stage-size-section\">\n      <label>\n        {$_('options.stageSize')}\n        <input type=\"number\" min=\"1\" max=\"4096\" step=\"1\" bind:value={$options.stageWidth}>\n        &times;\n        <input type=\"number\" min=\"1\" max=\"4096\" step=\"1\" bind:value={$options.stageHeight}>\n        <LearnMore slug=\"custom-stage-size\" />\n      </label>\n      <label>\n        <input type=\"radio\" name=\"resize-mode\" value=\"preserve-ratio\" bind:group={$options.resizeMode}>\n        {$_('options.preserveRatio')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"resize-mode\" value=\"stretch\" bind:group={$options.resizeMode}>\n        {$_('options.stretch')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"resize-mode\" value=\"dynamic-resize\" bind:group={$options.resizeMode}>\n        {$_('options.dynamicResize')}\n        <LearnMore slug=\"packager/dynamic-stage-resize\" />\n      </label>\n    </div>\n  </div>\n</Section>\n\n<Section\n  accent=\"#9966FF\"\n  reset={() => {\n    $icon = null;\n    $loadingScreenImage = null;\n    $customCursorIcon = null;\n    resetOptions([\n      'app',\n      'loadingScreen',\n      'autoplay',\n      'controls',\n      'appearance',\n      'monitors',\n      'cursor',\n      'chunks'\n    ]);\n  }}\n>\n  <div>\n    <h2>{$_('options.playerOptions')}</h2>\n\n    <label>\n      {$_('options.pageTitle')}\n      <input type=\"text\" bind:value={$options.app.windowTitle}>\n    </label>\n    <div>\n      {$_('options.icon')}\n      <ImageInput bind:file={$icon} previewSizes={[[64, 64], [32, 32], [16, 16]]} />\n    </div>\n\n    <h3>{$_('options.loadingScreen')}</h3>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.loadingScreen.progressBar}>\n      {$_('options.showProgressBar')}\n    </label>\n    <label>\n      {$_('options.loadingScreenText')}\n      <input type=\"text\" bind:value={$options.loadingScreen.text} placeholder={$_('options.loadingScreenTextPlaceholder')}>\n    </label>\n    <div class=\"option-group\">\n      {$_('options.loadingScreenImage')}\n      <!-- Display preview at image's native size -->\n      <ImageInput bind:file={$loadingScreenImage} previewSizes={[['', '']]} />\n    </div>\n    {#if $loadingScreenImage}\n      <label>\n        <input type=\"radio\" name=\"loading-screen-mode\" value=\"normal\" bind:group={$options.loadingScreen.imageMode}>\n        {$_('options.sizeNormal')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"loading-screen-mode\" value=\"stretch\" bind:group={$options.loadingScreen.imageMode}>\n        {$_('options.sizeStretch')}\n      </label>\n    {/if}\n\n    <h3>{$_('options.controls')}</h3>\n    <div class=\"option-group\">\n      <label>\n        <input type=\"checkbox\" bind:checked={$options.autoplay}>\n        {$_('options.autoplay')}\n      </label>\n      {#if $options.autoplay}\n        <div>\n          {$_('options.autoplayHint')}\n        </div>\n      {/if}\n    </div>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.controls.greenFlag.enabled}>\n      {$_('options.showFlag')}\n    </label>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.controls.stopAll.enabled}>\n      {$_('options.showStop')}\n    </label>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.controls.pause.enabled}>\n      {$_('options.showPause')}\n    </label>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.controls.fullscreen.enabled}>\n      {$_('options.showFullscreen')}\n    </label>\n    <p>{$_('options.controlsHelp')}</p>\n\n    <h3>{$_('options.colors')}</h3>\n    <!-- svelte-ignore a11y-label-has-associated-control -->\n    <label>\n      <ColorPicker bind:value={$options.appearance.background} />\n      {$_('options.backgroundColor')}\n    </label>\n    <!-- svelte-ignore a11y-label-has-associated-control -->\n    <label>\n      <ColorPicker bind:value={$options.appearance.foreground} />\n      {$_('options.foregroundColor')}\n    </label>\n    <!-- svelte-ignore a11y-label-has-associated-control -->\n    <label>\n      <ColorPicker bind:value={$options.appearance.accent} />\n      {$_('options.accentColor')}\n    </label>\n\n    <h3>{$_('options.monitors')}</h3>\n    <label>\n      <input type=\"checkbox\" bind:checked={$options.monitors.editableLists}>\n      {$_('options.editableLists')}\n    </label>\n\n    <h3>{$_('options.interaction')}</h3>\n    <div class=\"option-group\">\n      <label>\n        <input type=\"radio\" name=\"cursor-type\" bind:group={$options.cursor.type} value=\"auto\">\n        {$_('options.normalCursor')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"cursor-type\" bind:group={$options.cursor.type} value=\"none\">\n        {$_('options.noCursor')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"cursor-type\" bind:group={$options.cursor.type} value=\"custom\">\n        {$_('options.customCursor')}\n      </label>\n    </div>\n    {#if $options.cursor.type === 'custom'}\n      <div in:slide|self>\n        <ImageInput bind:file={$customCursorIcon} previewSizes={[[32, 32], [16, 16]]} />\n        <p>{$_('options.cursorHelp')}</p>\n      </div>\n    {/if}\n\n    <div class=\"option-group\">\n      <label>\n        <input type=\"checkbox\" bind:checked={$options.chunks.pointerlock}>\n        {$_('options.pointerlock')}\n      </label>\n      <div>\n        <a href=\"https://experiments.turbowarp.org/pointerlock/\" target=\"_blank\" rel=\"noopener\">\n          {$_('options.pointerlockHelp')}\n        </a>\n      </div>\n    </div>\n\n    <div class=\"option-group\">\n      <label>\n        <input type=\"checkbox\" bind:checked={$options.chunks.gamepad}>\n        {$_('options.gamepad')}\n      </label>\n      <div>\n        <a href=\"https://turbowarp.org/addons#gamepad\" target=\"_blank\" rel=\"noopener\">\n          {$_('options.gamepadHelp')}\n        </a>\n      </div>\n    </div>\n  </div>\n</Section>\n\n{#if cloudVariables.length > 0}\n  <Section\n    accent=\"#FF8C1A\"\n    reset={() => {\n      resetOptions([\n        'cloudVariables'\n      ]);\n    }}\n  >\n    <div>\n      <h2>{$_('options.cloudVariables')}</h2>\n      <label>\n        {$_('options.mode')}\n        <select bind:value={$options.cloudVariables.mode}>\n          <option value=\"ws\">{$_('options.cloudVariables-ws')}</option>\n          <option value=\"local\">{$_('options.cloudVariables-local')}</option>\n          <option value=\"\">{$_('options.cloudVariables-ignore')}</option>\n          <option value=\"custom\">{$_('options.cloudVariables-custom')}</option>\n        </select>\n      </label>\n      {#if $options.cloudVariables.mode === \"custom\"}\n        <div transition:slide|local>\n          {#each cloudVariables as variable}\n            <label>\n              <select bind:value={$options.cloudVariables.custom[variable]}>\n                <option value=\"ws\">{$_('options.cloudVariables-ws')}</option>\n                <option value=\"local\">{$_('options.cloudVariables-local')}</option>\n                <option value=\"\">{$_('options.cloudVariables-ignore')}</option>\n              </select>\n              {variable}\n            </label>\n          {/each}\n        </div>\n      {/if}\n      {#if $options.cloudVariables.mode === 'ws' || $options.cloudVariables.mode === 'custom'}\n        <label transition:slide|local>\n          {$_('options.cloudVariablesHost')}\n          <input type=\"text\" bind:value={$options.cloudVariables.cloudHost}>\n        </label>\n      {/if}\n      <p>{$_('options.cloudVariables-ws-help')}</p>\n      <p>{$_('options.cloudVariables-local-help')}</p>\n      <p>{$_('options.cloudVariables-ignore-help')}</p>\n      <p>{$_('options.cloudVariables-custom-help')}</p>\n      <label>\n        <input type=\"checkbox\" bind:checked={$options.cloudVariables.specialCloudBehaviors}>\n        {$_('options.specialCloudBehaviors')}\n        <LearnMore slug=\"packager/special-cloud-behaviors\" />\n      </label>\n    </div>\n  </Section>\n{/if}\n\n<Section\n  accent=\"#FF6680\"\n  reset={() => {\n    resetOptions([\n      'compiler',\n      'extensions',\n      'custom',\n      'projectId'\n    ]);\n  }}\n>\n  <div>\n    <h2>{$_('options.advancedOptions')}</h2>\n    <details>\n      <summary>{$_('options.advancedSummary')}</summary>\n      <label>\n        <input type=\"checkbox\" bind:checked={$options.compiler.enabled}>\n        {$_('options.enableCompiler')}\n        <LearnMore slug=\"disable-compiler\" />\n      </label>\n      <label>\n        <input type=\"checkbox\" bind:checked={$options.compiler.warpTimer}>\n        {$_('options.warpTimer')}\n        <LearnMore slug=\"warp-timer\" />\n      </label>\n      <!-- Ignore because CustomExtensions will have a <textarea> inside it -->\n      <!-- svelte-ignore a11y-label-has-associated-control -->\n      <label>\n        {$_('options.customExtensions')}\n        <!-- TODO: use the user-facing documentation when that becomes available -->\n        <LearnMore slug=\"development/custom-extensions\" />\n        <CustomExtensions bind:extensions={$options.extensions} />\n      </label>\n      <label>\n        {$_('options.customCSS')}\n        <textarea bind:value={$options.custom.css}></textarea>\n      </label>\n      <label>\n        {$_('options.customJS')}\n        <textarea bind:value={$options.custom.js}></textarea>\n      </label>\n      <label>\n        {$_('options.projectId')}\n        <input type=\"text\" bind:value={$options.projectId}>\n      </label>\n      <p>{$_('options.projectIdHelp')}</p>\n    </details>\n  </div>\n</Section>\n\n<Section\n  accent=\"#0FBD8C\"\n  reset={() => {\n    resetOptions([\n      'target'\n    ])\n  }}\n>\n  <div>\n    <h2>{$_('options.environment')}</h2>\n    <div class=\"option-group\">\n      <label>\n        <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"html\">\n        {$_('options.html')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"zip\">\n        {$_('options.zip')}\n      </label>\n    </div>\n    <div class=\"option-group\">\n      <label>\n        <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"electron-win32\">\n        {$_('options.application-win32').replace('{type}', 'Electron')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"webview-mac\">\n        {$_('options.application-mac').replace('{type}', 'WKWebView')}\n      </label>\n      <label>\n        <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"electron-linux64\">\n        {$_('options.application-linux64').replace('{type}', 'Electron')}\n      </label>\n    </div>\n    <details open={otherEnvironmentsInitiallyOpen}>\n      <summary>{$_('options.otherEnvironments')}</summary>\n      <p>{$_('options.otherEnvironmentsHelp')}</p>\n      <div class=\"option-group\">\n        <label>\n          <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"zip-one-asset\">\n          {$_('options.zip-one-asset')}\n        </label>\n      </div>\n      <div class=\"option-group\">\n        <label>\n          <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"electron-win64\">\n          {$_('options.application-win64').replace('{type}', 'Electron')}\n        </label>\n      </div>\n      <div class=\"option-group\">\n        <label>\n          <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"nwjs-win32\">\n          {$_('options.application-win32').replace('{type}', 'NW.js')}\n        </label>\n        <label>\n          <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"nwjs-win64\">\n          {$_('options.application-win64').replace('{type}', 'NW.js')}\n        </label>\n        <label>\n          <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"nwjs-mac\">\n          {$_('options.application-mac').replace('{type}', 'NW.js')}\n        </label>\n        <label>\n          <input type=\"radio\" name=\"environment\" bind:group={$options.target} value=\"nwjs-linux-x64\">\n          {$_('options.application-linux64').replace('{type}', 'NW.js')}\n        </label>\n      </div>\n    </details>\n  </div>\n</Section>\n\n{#if $options.target !== 'html'}\n  <div in:fade|local>\n    <Section\n      accent=\"#FF661A\"\n      reset={$options.target === 'zip' ? null : () => {\n        resetOptions([\n          'app'\n        ])\n      }}\n    >\n      <div>\n        {#if $options.target.startsWith('zip')}\n          <h2>Zip</h2>\n          <p>The zip environment is intended to be used for publishing to a website. Other uses such as sending your project to a friend over a chat app or email should use \"Plain HTML\" instead as zip will not work.</p>\n        {:else}\n          <h2>{$_('options.applicationSettings')}</h2>\n          <label>\n            {$_('options.packageName')}\n            <input type=\"text\" bind:value={$options.app.packageName} pattern=\"[a-zA-Z -]+\" minlength=\"1\">\n          </label>\n          <p>{$_('options.packageNameHelp')}</p>\n        {/if}\n\n        {#if $options.target.includes('win')}\n          <div>\n            <h2>Windows</h2>\n            <p>To change the icon of the executable file or create an installer program, download and run <a href=\"https://github.com/TurboWarp/packager-extras/releases\">TurboWarp Packager Extras</a> and select the output of this website.</p>\n            <p>All Windows applications generated by this site are unsigned, so users may see SmartScreen warnings when they try to launch it for the first time.</p>\n            {#if $options.target.includes('nwjs')}\n              <p class=\"warning\">NW.js support is deprecated and may be removed in the future. Use Electron instead if possible.</p>\n            {/if}\n            {#if $options.target.endsWith('64')}\n              <p>The application will only run on 64-bit x86 computers.</p>\n            {:else if $options.target.endsWith('32')}\n              <p>The application will run on 32-bit and 64-bit x86 computers.</p>\n              <p>If large projects tend to crash, use 64-bit only mode instead (in Other environments).</p>\n            {/if}\n          </div>\n        {:else if $options.target.includes('mac')}\n          <h2>macOS</h2>\n          <p>Due to Apple policy, packaging for their platforms is troublesome. You either have to:</p>\n          <ul>\n            <li>Instruct users to ignore scary Gatekeeper warnings by opening Finder > Navigating to the application > Right click > Open > Open. This website generates applications that require this workaround.</li>\n            <li>Or pay Apple $100/year for a developer account to sign and notarize the app (very involved process; reach out in feedback for more information)</li>\n          </ul>\n          {#if $options.target.includes('webview')}\n            <h2>WKWebView</h2>\n            <p>WKWebView is the fastest and smallest way to package for macOS. It should run natively (without Rosetta) on both Intel and Apple silicon Macs running macOS 10.12 or later.</p>\n            <p>Note that:</p>\n            <ul>\n              <li>Video sensing and loudness blocks will not work</li>\n              <li>Extremely memory intensive projects may not work well</li>\n            </ul>\n            <p>Use \"Plain HTML\" or \"NW.js macOS Application\" if these are problems for your project.</p>\n          {:else if $options.target.includes('nwjs')}\n            <h2>NW.js</h2>\n            <p>NW.js runs natively on Intel Macs but will use Rosetta on Apple silicon Macs.</p>\n            <p>For further help and steps, see <a href=\"https://docs.nwjs.io/en/latest/For%20Users/Package%20and%20Distribute/#mac-os-x\">NW.js Documentation</a>.</p>\n          {/if}\n        {:else if $options.target.includes('linux')}\n          <h2>Linux</h2>\n          <p>Linux support is still experimental.</p>\n          <p>The application will only run on 64-bit x86 computers. 32-bit computers, Raspberry Pis, and other ARM devices will not work.</p>\n          {#if $options.target.includes('electron')}\n            <p>The application is started by running <code>start.sh</code>.</p>\n          {:else if $options.target.includes('nwjs')}\n            <p class=\"warning\">NW.js support is deprecated and may be removed in the future. Use Electron instead if possible.</p>\n            <p>For further help and steps, see <a href=\"https://docs.nwjs.io/en/latest/For%20Users/Package%20and%20Distribute/#linux\">NW.js Documentation</a>.</p>\n          {/if}\n        {/if}\n      </div>\n    </Section>\n  </div>\n{/if}\n\n<Section>\n  <Button on:click={pack} text={$_('options.package')} />\n  <Button on:click={preview} secondary text={$_('options.preview')} />\n</Section>\n\n{#if result}\n  <Section center>\n    <p>\n      <a href={result.url} download={result.filename}>\n        {$_('options.download')\n          .replace('{filename}', result.filename)\n          .replace('{size}', (result.blob.size / 1000 / 1000).toFixed(2))}\n      </a>\n    </p>\n  </Section>\n{:else if !$progress.visible}\n  <Section caption>\n    <p>{$_('options.downloadsWillAppearHere')}</p>\n  </Section>\n{/if}\n"],"sourceRoot":""}